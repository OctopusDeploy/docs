---
layout: src/layouts/Default.astro
pubDate: 2014-08-26
title: 'File System - Create Symlink'
description: 'Creates a Symbolic Link'
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2014-08-26 by diegoavanzini belongs to 'File System' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### LinkPath

`link_path`

null

</div>
        
<div class="param">

### TargetPath

`target_path`

null

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```PowerShell
function New-Symlink {
    <#
    .SYNOPSIS
        Creates a symbolic link.
    #>
    param (
        [Parameter(Position=0, Mandatory=$true)]
        [string] $Link,
        [Parameter(Position=1, Mandatory=$true)]
        [string] $Target
    )

    Write-Host "New-Symlink $Link to $Target"
    
    Invoke-MKLINK -Link $Link -Target $Target
}

function Invoke-MKLINK {
    <#
    .SYNOPSIS
        Creates a symbolic link.
    #>
    param (
        [Parameter(Position=0, Mandatory=$true)]
        [string] $Link,
        [Parameter(Position=1, Mandatory=$true)]
        [string] $Target
    )
    
    # Resolve the paths incase a relative path was passed in.
    $Link = (Force-Resolve-Path $Link)
    $Target = (Force-Resolve-Path $Target)

    # Ensure target exists.
    if (-not(Test-Path $Target)) {
        throw "Target does not exist.`nTarget: $Target"
    }

    # Ensure link does not exist.
    if (Test-Path $Link) {
        Write-Host "A file or directory already exists at the link path.`nLink: $Link"
        return
    }

    $isDirectory = (Get-Item $Target).PSIsContainer

    # Capture the MKLINK output so we can return it properly.
    # Includes a redirect of STDERR to STDOUT so we can capture it as well.
    $output = cmd /c mklink /D `"$Link`" `"$Target`" 2>&1
    
    Write-Host "output : $output"
    if ($lastExitCode -ne 0) {
        Write-Host "MKLINK failed. Exit code: $lastExitCode`n$output"
        throw "MKLINK failed. Exit code: $lastExitCode`n$output"
    }
    else {
        Write-Output $output
    }
}

function Force-Resolve-Path {
    <#
    .SYNOPSIS
        Calls Resolve-Path but works for files that don't exist.
    .REMARKS
        From http://devhawk.net/2010/01/21/fixing-powershells-busted-resolve-path-cmdlet/
    #>
    param (
        [string] $FileName
    )
    
    $FileName = Resolve-Path $FileName -ErrorAction SilentlyContinue `
                                       -ErrorVariable _frperror
    if (-not($FileName)) {
        $FileName = $_frperror[0].TargetObject
    }
    
    return $FileName
}

New-Symlink $link_path $target_path



```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20File%20System%20-%20Create%20Symlink&step-template=File%20System%20-%20Create%20Symlink)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "f0cae939-caef-4979-93ac-6c9b3a3c4986",
  "Name": "File System - Create Symlink",
  "Description": "Creates a Symbolic Link",
  "Version": 23,
  "ExportedAt": "2014-08-26T15:58:34.242+00:00",
  "ActionType": "Octopus.Script",
  "Author": "diegoavanzini",
  "Parameters": [
    {
      "Name": "link_path",
      "Label": "LinkPath",
      "HelpText": null,
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "target_path",
      "Label": "TargetPath",
      "HelpText": null,
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptBody": "function New-Symlink {\n    <#\n    .SYNOPSIS\n        Creates a symbolic link.\n    #>\n    param (\n        [Parameter(Position=0, Mandatory=$true)]\n        [string] $Link,\n        [Parameter(Position=1, Mandatory=$true)]\n        [string] $Target\n    )\n\n    Write-Host \"New-Symlink $Link to $Target\"\n    \n    Invoke-MKLINK -Link $Link -Target $Target\n}\n\nfunction Invoke-MKLINK {\n    <#\n    .SYNOPSIS\n        Creates a symbolic link.\n    #>\n    param (\n        [Parameter(Position=0, Mandatory=$true)]\n        [string] $Link,\n        [Parameter(Position=1, Mandatory=$true)]\n        [string] $Target\n    )\n    \n    # Resolve the paths incase a relative path was passed in.\n    $Link = (Force-Resolve-Path $Link)\n    $Target = (Force-Resolve-Path $Target)\n\n    # Ensure target exists.\n    if (-not(Test-Path $Target)) {\n        throw \"Target does not exist.`nTarget: $Target\"\n    }\n\n    # Ensure link does not exist.\n    if (Test-Path $Link) {\n        Write-Host \"A file or directory already exists at the link path.`nLink: $Link\"\n        return\n    }\n\n    $isDirectory = (Get-Item $Target).PSIsContainer\n\n    # Capture the MKLINK output so we can return it properly.\n    # Includes a redirect of STDERR to STDOUT so we can capture it as well.\n    $output = cmd /c mklink /D `\"$Link`\" `\"$Target`\" 2>&1\n    \n    Write-Host \"output : $output\"\n    if ($lastExitCode -ne 0) {\n        Write-Host \"MKLINK failed. Exit code: $lastExitCode`n$output\"\n        throw \"MKLINK failed. Exit code: $lastExitCode`n$output\"\n    }\n    else {\n        Write-Output $output\n    }\n}\n\nfunction Force-Resolve-Path {\n    <#\n    .SYNOPSIS\n        Calls Resolve-Path but works for files that don't exist.\n    .REMARKS\n        From http://devhawk.net/2010/01/21/fixing-powershells-busted-resolve-path-cmdlet/\n    #>\n    param (\n        [string] $FileName\n    )\n    \n    $FileName = Resolve-Path $FileName -ErrorAction SilentlyContinue `\n                                       -ErrorVariable _frperror\n    if (-not($FileName)) {\n        $FileName = $_frperror[0].TargetObject\n    }\n    \n    return $FileName\n}\n\nNew-Symlink $link_path $target_path\n\n\n",
    "Octopus.Action.Script.Syntax": "PowerShell"
  },
  "Category": "File System",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/file-system-create-symlink.json",
  "Website": "/step-templates/f0cae939-caef-4979-93ac-6c9b3a3c4986",
  "Logo": "https://i.octopus.com/library/step-templates/filesystem.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/file-system-create-symlink.json)

</div>
