---
layout: src/layouts/Default.astro
pubDate: 2018-03-29
title: 'Azure - Set Web App SSL Certificate'
description: 'Configures the SSL binding for an Azure Web App to use an [Octopus-managed certificate](https://octopus.com/docs/deploying-applications/certificates)'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.AzurePowerShell exported 2018-03-29 by MJRichardson belongs to 'Azure' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Azure Subscription

`SslAzureSubscription = `

null

</div>
        
<div class="param">

### Azure Web App

`SslWebApp = `

The name of the Azure Web App for which the SSL binding will be created.

</div>
        
<div class="param">

### Resource Group

`SslResourceGroup = `

The name of the Azure Resource Group containing the Web App

</div>
        
<div class="param">

### Slot

`SslSlot = `

The Azure Deployment Slot (optional)

</div>
        
<div class="param">

### Domain Name

`SslDomainName = `

The fully qualified domain name for the SSL binding. e.g. store.acme.com

</div>
        
<div class="param">

### Certificate

`SslCertificate = `

The certificate to be used for the SSL binding

</div>
        
<div class="param">

### SSL State

`SslState = SniEnabled`

Specifies the SSL state of the certificate

</div>
        

## Script body

Steps based on this template will execute the following *undefined* script.

```text
<#
Takes an Octopus certificate variable and
    1) Writes it to a temporary file with a password (as Azure requires the PFX have a password)
    2) Invokes New-AzureRmWebAppSSLBinding
    3) Removes the temporary certificate file
#>

$ErrorActionPreference = 'Stop'

Write-Verbose "Creating temporary certificate file"
$TempCertificateFile = New-TemporaryFile
# The PFX upload to Azure must have a password. So we give it a GUID.
$Password = [guid]::NewGuid().ToString("N")

$CertificateName = $OctopusParameters["SslCertificate.Name"]

Write-Host "Creating HTTPS binding on web app '$SslWebApp' for domain $SslDomainName using certificate '$CertificateName' "

$CertificateBytes = [Convert]::FromBase64String($OctopusParameters["SslCertificate.Pfx"])
[IO.File]::WriteAllBytes($TempCertificateFile.FullName, $CertificateBytes)
Get-PfxData -FilePath $TempCertificateFile.FullName | Export-PfxCertificate -FilePath $TempCertificateFile.FullName -Password (ConvertTo-SecureString -String $Password -AsPlainText -Force)

$BindingParams = @{
    WebAppName = $SslWebApp
    ResourceGroupName = $SslResourceGroup
    Name = $SslDomainName
    CertificateFilePath = $TempCertificateFile.FullName
    CertificatePassword = $Password
    SslState = $SslState
}

if ($SslSlot) { $BindingParams['Slot'] = $SslSlot }

New-AzureRmWebAppSSLBinding @BindingParams

Write-Verbose "Removing temporary certificate file"
Remove-Item $TempCertificateFile.FullName -Force
```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20Azure%20-%20Set%20Web%20App%20SSL%20Certificate&step-template=Azure%20-%20Set%20Web%20App%20SSL%20Certificate)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "72a32f48-2de9-4dac-9c47-b491413478e2",
  "Name": "Azure - Set Web App SSL Certificate",
  "Description": "Configures the SSL binding for an Azure Web App to use an [Octopus-managed certificate](https://octopus.com/docs/deploying-applications/certificates)",
  "Version": 1,
  "ExportedAt": "2018-03-29T00:48:05.333Z",
  "ActionType": "Octopus.AzurePowerShell",
  "Author": "MJRichardson",
  "Parameters": [
    {
      "Id": "a8d7da9d-39d6-4bcd-9a08-fe81210e364c",
      "Name": "SslAzureSubscription",
      "Label": "Azure Subscription",
      "HelpText": null,
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "AzureAccount"
      },
      "Links": {}
    },
    {
      "Id": "4b978b3d-4f87-49d7-b814-14e2f9ef878a",
      "Name": "SslWebApp",
      "Label": "Azure Web App",
      "HelpText": "The name of the Azure Web App for which the SSL binding will be created.",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "df5ee03d-1a63-44c0-b3c4-d75020b1f2b8",
      "Name": "SslResourceGroup",
      "Label": "Resource Group",
      "HelpText": "The name of the Azure Resource Group containing the Web App",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "ff318b09-27de-483c-a9c8-b0583e15208c",
      "Name": "SslSlot",
      "Label": "Slot",
      "HelpText": "The Azure Deployment Slot (optional)",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "9f488222-f373-4f70-841b-3f340357bb85",
      "Name": "SslDomainName",
      "Label": "Domain Name",
      "HelpText": "The fully qualified domain name for the SSL binding. e.g. store.acme.com",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "b8bda333-894a-4223-a07d-afb336b8f75f",
      "Name": "SslCertificate",
      "Label": "Certificate",
      "HelpText": "The certificate to be used for the SSL binding",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "Certificate"
      },
      "Links": {}
    },
    {
      "Id": "b9c953f5-a21d-4c64-b134-7295d6d7d48e",
      "Name": "SslState",
      "Label": "SSL State",
      "HelpText": "Specifies the SSL state of the certificate",
      "DefaultValue": "SniEnabled",
      "DisplaySettings": {
        "Octopus.ControlType": "Select",
        "Octopus.SelectOptions": "SniEnabled\nIpBasedEnabled\nDisabled"
      },
      "Links": {}
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptSource": "Inline",
    "Octopus.Action.Azure.AccountId": "#{SslAzureSubscription}",
    "Octopus.Action.Script.ScriptBody": "<#\nTakes an Octopus certificate variable and\n    1) Writes it to a temporary file with a password (as Azure requires the PFX have a password)\n    2) Invokes New-AzureRmWebAppSSLBinding\n    3) Removes the temporary certificate file\n#>\n\n$ErrorActionPreference = 'Stop'\n\nWrite-Verbose \"Creating temporary certificate file\"\n$TempCertificateFile = New-TemporaryFile\n# The PFX upload to Azure must have a password. So we give it a GUID.\n$Password = [guid]::NewGuid().ToString(\"N\")\n\n$CertificateName = $OctopusParameters[\"SslCertificate.Name\"]\n\nWrite-Host \"Creating HTTPS binding on web app '$SslWebApp' for domain $SslDomainName using certificate '$CertificateName' \"\n\n$CertificateBytes = [Convert]::FromBase64String($OctopusParameters[\"SslCertificate.Pfx\"])\n[IO.File]::WriteAllBytes($TempCertificateFile.FullName, $CertificateBytes)\nGet-PfxData -FilePath $TempCertificateFile.FullName | Export-PfxCertificate -FilePath $TempCertificateFile.FullName -Password (ConvertTo-SecureString -String $Password -AsPlainText -Force)\n\n$BindingParams = @{\n    WebAppName = $SslWebApp\n    ResourceGroupName = $SslResourceGroup\n    Name = $SslDomainName\n    CertificateFilePath = $TempCertificateFile.FullName\n    CertificatePassword = $Password\n    SslState = $SslState\n}\n\nif ($SslSlot) { $BindingParams['Slot'] = $SslSlot }\n\nNew-AzureRmWebAppSSLBinding @BindingParams\n\nWrite-Verbose \"Removing temporary certificate file\"\nRemove-Item $TempCertificateFile.FullName -Force"
  },
  "Category": "Azure",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/azure-web-app-ssl.json",
  "Website": "/step-templates/72a32f48-2de9-4dac-9c47-b491413478e2",
  "Logo": "https://i.octopus.com/library/step-templates/azure.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/azure-web-app-ssl.json)

</div>
