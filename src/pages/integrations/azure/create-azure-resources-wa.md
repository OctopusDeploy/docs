---
layout: src/layouts/Default.astro
pubDate: 2018-01-08
title: 'Create Azure Resources - WA'
description: 'The New-AzureRmAppServicePlan cmdlet creates a new app service plan.
The New-AzureRmWebApp cmdlet creates a new web app.'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.AzurePowerShell exported 2018-01-08 by IanMoroney belongs to 'Azure' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### ResourceGroupName

`ResourceGroupName`

Enter the name of the resource group you are deploying this Web App into

</div>
        
<div class="param">

### DeploymentLocation

`Location`

Enter the location (Region) where the service plan is located

</div>
        
<div class="param">

### AppServicePlanName

`AppServicePlanName`

Enter the name of the app service plan

</div>
        
<div class="param">

### AppServicePlanTier

`AppServicePlanTier`

Enter the tier of the app service plan

</div>
        
<div class="param">

### WebAppName

`WebAppName`

Enter the name of your web app

</div>
        
<div class="param">

### AppServiceUse32BitWorkerProcess

`AppServiceUse32BitWorkerProcess`

Sets the app pool for 32-bit processes or 64-bit processes.
Use 1 for 32-bit
Use 0 for 64-bit

</div>
        
<div class="param">

### AzureAccount

`AzureAccount`

Enter the SPN used to connect to Azure

</div>
        

## Script body

Steps based on this template will execute the following *undefined* script.

```text
###############################################
##Step 1: Get Variables
$ResourceGroupName             = $OctopusParameters["ResourceGroupName"] 
$DeploymentLocation            = $OctopusParameters["Location"] 
$AppServicePlanName            = $OctopusParameters["AppServicePlanName"] 
$AppServicePlanTier            = $OctopusParameters["AppServicePlanTier"]
$WebAppName                    = $OctopusParameters["WebAppName"]
$TimeStamp                          = Get-Date -Format ddMMyyyy_hhmmss
$PublishProfilePath                 = Join-Path -Path $ENV:Temp -ChildPath "publishprofile$TimeStamp.xml"
$AppServiceUse32BitWorkerProcess= $OctopusParameters["AppServiceUse32BitWorkerProcess"] 
###############################################

###############################################
##Step 2: Check and Create Service Plan
try{
  $ServicePlan= Get-AzureRmAppServicePlan -ResourceGroupName $ResourceGroupName -Name $AppServicePlanName  -ErrorAction SilentlyContinue 
  if ($null -eq $ServicePlan)
  {
    Write-Output "Creating Service Plan"
    $ServicePlan=New-AzureRmAppServicePlan -Name $AppServicePlanName -Location $Location -ResourceGroupName $ResourceGroupName -Tier $AppServicePlanTier
  }
  else{
      Write-Output "Service Plan already set up"
  }
  $WebApp = Get-AzureRmWebApp -ResourceGroupName $ResourceGroupName -Name $WebAppName -ErrorAction SilentlyContinue
  if($null -eq $WebApp)
  {
      Write-Output "Creating WebApp"
      $webApp = New-AzureRmWebApp -Name $WebAppName -AppServicePlan $AppServicePlanName -ResourceGroupName $ResourceGroupName -Location $DeploymentLocation
  }
  else {
      Write-Output "WebApp already created"
  }
  
  Write-Output "setting app to use $AppServiceUse32BitWorkerProcess" 
  Set-AzureRmWebApp -ResourceGroupName $ResourceGroupName -Name $WebAppName -Use32BitWorkerProcess ([bool]$AppServiceUse32BitWorkerProcess)
  $null = Get-AzureRmWebAppPublishingProfile -OutputFile $PublishProfilePath -ResourceGroupName $ResourceGroupName -Name $WebAppName -Format WebDeploy -Verbose
  
  Write-output "profile: $(get-content  $PublishProfilePath)"
  if (!(Test-Path -Path $PublishProfilePath)){
    throw [System.IO.FileNotFoundException] "$PublishProfilePath not found."
  }

    get-childitem $psscriptroot
}
catch{
  Write-Output "Cannot add serviceplan/webapp : $AzureAppServicePlanName / $AzureWebAppName"
  Write-Output $_

}

```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20Create%20Azure%20Resources%20-%20WA&step-template=Create%20Azure%20Resources%20-%20WA)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "c9a3122f-6723-4753-8461-f9fb3e73a513",
  "Name": "Create Azure Resources - WA",
  "Description": "The New-AzureRmAppServicePlan cmdlet creates a new app service plan.\nThe New-AzureRmWebApp cmdlet creates a new web app.",
  "Version": 1,
  "ExportedAt": "2018-01-08T10:36:38.951Z",
  "ActionType": "Octopus.AzurePowerShell",
  "Author": "IanMoroney",
  "Parameters": [
    {
      "Id": "f6595af0-9cb5-4281-8fce-69f046c53e96",
      "Name": "ResourceGroupName",
      "Label": "ResourceGroupName",
      "HelpText": "Enter the name of the resource group you are deploying this Web App into",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "f8d7d8c4-e862-436d-bea3-aa3f9a6caec3",
      "Name": "Location",
      "Label": "DeploymentLocation",
      "HelpText": "Enter the location (Region) where the service plan is located",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "ef49ded7-ec59-482b-83bd-e890d36103b9",
      "Name": "AppServicePlanName",
      "Label": "AppServicePlanName",
      "HelpText": "Enter the name of the app service plan",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "554a3a1c-9235-45e9-b198-d77cd8dae52d",
      "Name": "AppServicePlanTier",
      "Label": "AppServicePlanTier",
      "HelpText": "Enter the tier of the app service plan",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "eee220dc-1af4-44ce-9bfc-950e87e9587d",
      "Name": "WebAppName",
      "Label": "WebAppName",
      "HelpText": "Enter the name of your web app",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "1f60c02e-77d1-4f2f-9874-87da815fc157",
      "Name": "AppServiceUse32BitWorkerProcess",
      "Label": "AppServiceUse32BitWorkerProcess",
      "HelpText": "Sets the app pool for 32-bit processes or 64-bit processes.\nUse 1 for 32-bit\nUse 0 for 64-bit",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "7dda30f1-94e4-4a2a-beb6-c8663924bdee",
      "Name": "AzureAccount",
      "Label": "AzureAccount",
      "HelpText": "Enter the SPN used to connect to Azure",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    }
  ],
  "Properties": {
    "Octopus.Action.Azure.AccountId": "#{AzureAccount}",
    "Octopus.Action.Script.ScriptSource": "Inline",
    "Octopus.Action.Script.ScriptBody": "###############################################\n##Step 1: Get Variables\n$ResourceGroupName             = $OctopusParameters[\"ResourceGroupName\"] \n$DeploymentLocation            = $OctopusParameters[\"Location\"] \n$AppServicePlanName            = $OctopusParameters[\"AppServicePlanName\"] \n$AppServicePlanTier            = $OctopusParameters[\"AppServicePlanTier\"]\n$WebAppName                    = $OctopusParameters[\"WebAppName\"]\n$TimeStamp                          = Get-Date -Format ddMMyyyy_hhmmss\n$PublishProfilePath                 = Join-Path -Path $ENV:Temp -ChildPath \"publishprofile$TimeStamp.xml\"\n$AppServiceUse32BitWorkerProcess= $OctopusParameters[\"AppServiceUse32BitWorkerProcess\"] \n###############################################\n\n###############################################\n##Step 2: Check and Create Service Plan\ntry{\n  $ServicePlan= Get-AzureRmAppServicePlan -ResourceGroupName $ResourceGroupName -Name $AppServicePlanName  -ErrorAction SilentlyContinue \n  if ($null -eq $ServicePlan)\n  {\n    Write-Output \"Creating Service Plan\"\n    $ServicePlan=New-AzureRmAppServicePlan -Name $AppServicePlanName -Location $Location -ResourceGroupName $ResourceGroupName -Tier $AppServicePlanTier\n  }\n  else{\n      Write-Output \"Service Plan already set up\"\n  }\n  $WebApp = Get-AzureRmWebApp -ResourceGroupName $ResourceGroupName -Name $WebAppName -ErrorAction SilentlyContinue\n  if($null -eq $WebApp)\n  {\n      Write-Output \"Creating WebApp\"\n      $webApp = New-AzureRmWebApp -Name $WebAppName -AppServicePlan $AppServicePlanName -ResourceGroupName $ResourceGroupName -Location $DeploymentLocation\n  }\n  else {\n      Write-Output \"WebApp already created\"\n  }\n  \n  Write-Output \"setting app to use $AppServiceUse32BitWorkerProcess\" \n  Set-AzureRmWebApp -ResourceGroupName $ResourceGroupName -Name $WebAppName -Use32BitWorkerProcess ([bool]$AppServiceUse32BitWorkerProcess)\n  $null = Get-AzureRmWebAppPublishingProfile -OutputFile $PublishProfilePath -ResourceGroupName $ResourceGroupName -Name $WebAppName -Format WebDeploy -Verbose\n  \n  Write-output \"profile: $(get-content  $PublishProfilePath)\"\n  if (!(Test-Path -Path $PublishProfilePath)){\n    throw [System.IO.FileNotFoundException] \"$PublishProfilePath not found.\"\n  }\n\n    get-childitem $psscriptroot\n}\ncatch{\n  Write-Output \"Cannot add serviceplan/webapp : $AzureAppServicePlanName / $AzureWebAppName\"\n  Write-Output $_\n\n}\n",
    "Octopus.Action.Package.FeedId": null,
    "Octopus.Action.Script.ScriptFileName": null,
    "Octopus.Action.Package.PackageId": null
  },
  "Category": "Azure",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/azure-create-new-webapp.json",
  "Website": "/step-templates/c9a3122f-6723-4753-8461-f9fb3e73a513",
  "Logo": "https://i.octopus.com/library/step-templates/azure.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/azure-create-new-webapp.json)

</div>
