---
layout: src/layouts/Default.astro
pubDate: 2015-10-20
title: 'ClickOnceRe-Sign'
description: 'This Template will help to re-sign the .application and manifest files. Finally add .deploy extenstion to the files'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2015-10-20 by mani0070 belongs to 'ClickOnce' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Signing Certificate Path

`signcertpath`

null

</div>
        
<div class="param">

### Signing Certificate Password

`signCertPass`

null

</div>
        
<div class="param">

### Deployment Path

`baseDeployPath`

null

</div>
        
<div class="param">

### Application Name

`AppName`

null

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```powershell
$xml = [xml](Get-Content "$baseDeployPath\$AppName.application")
$manifestpath = $xml.assembly.dependency.dependentAssembly.codebase
$ApplicationWithVersion = $manifestpath.Split('\\')[1]

#Manifest Resign
& "C:\Program Files (x86)\Microsoft SDKs\Windows\v8.0A\bin\NETFX 4.0 Tools\mage.exe" -Update "$baseDeployPath\$manifestpath" -FromDirectory "$baseDeployPath\Application Files\$ApplicationWithVersion"
& "C:\Program Files (x86)\Microsoft SDKs\Windows\v8.0A\bin\NETFX 4.0 Tools\mage.exe" -Sign "$baseDeployPath\$manifestpath" -CertFile $signcertpath -Password $signCertPass

#Application Resign
& "C:\Program Files (x86)\Microsoft SDKs\Windows\v7.0A\Bin\mage.exe" -Update "$baseDeployPath\$AppName.application" -AppManifest "$baseDeployPath\$manifestpath"
& "C:\Program Files (x86)\Microsoft SDKs\Windows\v7.0A\Bin\mage.exe" -Sign "$baseDeployPath\$AppName.application" -CertFile $signcertpath -Password $signCertPass

#Rename files back to the .deploy extension, skipping the files that shouldn't be renamed
Get-ChildItem -Path "$baseDeployPath\Application Files\*"  -Recurse | Where-Object {!$_.PSIsContainer -and $_.Name -notlike "*.manifest" -and $_.Name -notlike "*.vsto"} | Rename-Item -NewName {$_.Name + ".deploy"} 
```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20ClickOnceRe-Sign&step-template=ClickOnceRe-Sign)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "a9e5843e-d382-44fd-84dd-d999dab54993",
  "Name": "ClickOnceRe-Sign",
  "Description": "This Template will help to re-sign the .application and manifest files. Finally add .deploy extenstion to the files",
  "Version": 6,
  "ExportedAt": "2015-10-20T20:26:27.693+00:00",
  "ActionType": "Octopus.Script",
  "Author": "mani0070",
  "Parameters": [
    {
      "Name": "signcertpath",
      "Label": "Signing Certificate Path",
      "HelpText": null,
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "signCertPass",
      "Label": "Signing Certificate Password",
      "HelpText": null,
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "baseDeployPath",
      "Label": "Deployment Path",
      "HelpText": null,
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "AppName",
      "Label": "Application Name",
      "HelpText": null,
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.Syntax": "PowerShell",
    "Octopus.Action.Script.ScriptBody": "$xml = [xml](Get-Content \"$baseDeployPath\\$AppName.application\")\n$manifestpath = $xml.assembly.dependency.dependentAssembly.codebase\n$ApplicationWithVersion = $manifestpath.Split('\\\\')[1]\n\n#Manifest Resign\n& \"C:\\Program Files (x86)\\Microsoft SDKs\\Windows\\v8.0A\\bin\\NETFX 4.0 Tools\\mage.exe\" -Update \"$baseDeployPath\\$manifestpath\" -FromDirectory \"$baseDeployPath\\Application Files\\$ApplicationWithVersion\"\n& \"C:\\Program Files (x86)\\Microsoft SDKs\\Windows\\v8.0A\\bin\\NETFX 4.0 Tools\\mage.exe\" -Sign \"$baseDeployPath\\$manifestpath\" -CertFile $signcertpath -Password $signCertPass\n\n#Application Resign\n& \"C:\\Program Files (x86)\\Microsoft SDKs\\Windows\\v7.0A\\Bin\\mage.exe\" -Update \"$baseDeployPath\\$AppName.application\" -AppManifest \"$baseDeployPath\\$manifestpath\"\n& \"C:\\Program Files (x86)\\Microsoft SDKs\\Windows\\v7.0A\\Bin\\mage.exe\" -Sign \"$baseDeployPath\\$AppName.application\" -CertFile $signcertpath -Password $signCertPass\n\n#Rename files back to the .deploy extension, skipping the files that shouldn't be renamed\nGet-ChildItem -Path \"$baseDeployPath\\Application Files\\*\"  -Recurse | Where-Object {!$_.PSIsContainer -and $_.Name -notlike \"*.manifest\" -and $_.Name -notlike \"*.vsto\"} | Rename-Item -NewName {$_.Name + \".deploy\"} "
  },
  "Category": "ClickOnce",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/clickonce-re-sign.json",
  "Website": "/step-templates/a9e5843e-d382-44fd-84dd-d999dab54993",
  "Logo": "https://i.octopus.com/library/step-templates/clickonce.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/clickonce-re-sign.json)

</div>
