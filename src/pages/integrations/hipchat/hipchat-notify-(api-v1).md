---
layout: src/layouts/Default.astro
pubDate: 2014-06-11
title: 'HipChat - Notify (API v1)'
description: 'Send a success notification when this step is executed.'
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2014-06-11 by bobjwalker belongs to 'HipChat' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Room Id

`HipChatRoomId`

null

</div>
        
<div class="param">

### Auth token

`HipChatAuthToken`

For API version 1.

</div>
        
<div class="param">

### From name

`HipChatFrom = Octopus Deploy`

null

</div>
        
<div class="param">

### Color

`HipChatColor = green`

HipChat message color

</div>
        
<div class="param">

### Message

`HipChatMessage`

You can use variables here. Leave blank for the default build notification format.

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```PowerShell
$message = if ($OctopusParameters['HipChatMessage']) { $OctopusParameters['HipChatMessage'] } else { "(successful) " + $OctopusParameters['Octopus.Project.Name'] + " [v$($OctopusParameters['Octopus.Release.Number'])] deployed to $($OctopusParameters['Octopus.Environment.Name'])  on $($OctopusParameters['Octopus.Machine.Name'])" } 
#---------
$apitoken = $OctopusParameters['HipChatAuthToken']
$roomid = $OctopusParameters['HipChatRoomId']
$from = $OctopusParameters['HipChatFrom']
$colour = $OctopusParameters['HipChatColor']

Try 
{
	#Do the HTTP POST to HipChat
	$post = "auth_token=$apitoken&room_id=$roomid&from=$from&color=$colour&message=$message&notify=1&message_format=text"
	$webRequest = [System.Net.WebRequest]::Create("https://api.hipchat.com/v1/rooms/message")
	$webRequest.ContentType = "application/x-www-form-urlencoded"
	$postStr = [System.Text.Encoding]::UTF8.GetBytes($post)
	$webrequest.ContentLength = $postStr.Length
	$webRequest.Method = "POST"
	$requestStream = $webRequest.GetRequestStream()
	$requestStream.Write($postStr, 0,$postStr.length)
	$requestStream.Close()
	
	[System.Net.WebResponse] $resp = $webRequest.GetResponse();
	$rs = $resp.GetResponseStream();
	[System.IO.StreamReader] $sr = New-Object System.IO.StreamReader -argumentList $rs;
	$sr.ReadToEnd();					
}
catch [Exception] {
	"Woah!, wasn't expecting to get this exception. `r`n $_.Exception.ToString()"
}
```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20HipChat%20-%20Notify%20(API%20v1)&step-template=HipChat%20-%20Notify%20(API%20v1))

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "c37ccd22-2b31-4263-8389-9e63868519b4",
  "Name": "HipChat - Notify (API v1)",
  "Description": "Send a success notification when this step is executed.",
  "Version": 5,
  "ExportedAt": "2014-06-11T02:21:16.787+00:00",
  "ActionType": "Octopus.Script",
  "Author": "bobjwalker",
  "Parameters": [
    {
      "Name": "HipChatRoomId",
      "Label": "Room Id",
      "HelpText": null,
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "HipChatAuthToken",
      "Label": "Auth token",
      "HelpText": "For API version 1.",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "HipChatFrom",
      "Label": "From name",
      "HelpText": null,
      "DefaultValue": "Octopus Deploy",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "HipChatColor",
      "Label": "Color",
      "HelpText": "HipChat message color",
      "DefaultValue": "green",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "HipChatMessage",
      "Label": "Message",
      "HelpText": "You can use variables here. Leave blank for the default build notification format.",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptBody": "$message = if ($OctopusParameters['HipChatMessage']) { $OctopusParameters['HipChatMessage'] } else { \"(successful) \" + $OctopusParameters['Octopus.Project.Name'] + \" [v$($OctopusParameters['Octopus.Release.Number'])] deployed to $($OctopusParameters['Octopus.Environment.Name'])  on $($OctopusParameters['Octopus.Machine.Name'])\" } \n#---------\n$apitoken = $OctopusParameters['HipChatAuthToken']\n$roomid = $OctopusParameters['HipChatRoomId']\n$from = $OctopusParameters['HipChatFrom']\n$colour = $OctopusParameters['HipChatColor']\n\nTry \n{\n\t#Do the HTTP POST to HipChat\n\t$post = \"auth_token=$apitoken&room_id=$roomid&from=$from&color=$colour&message=$message&notify=1&message_format=text\"\n\t$webRequest = [System.Net.WebRequest]::Create(\"https://api.hipchat.com/v1/rooms/message\")\n\t$webRequest.ContentType = \"application/x-www-form-urlencoded\"\n\t$postStr = [System.Text.Encoding]::UTF8.GetBytes($post)\n\t$webrequest.ContentLength = $postStr.Length\n\t$webRequest.Method = \"POST\"\n\t$requestStream = $webRequest.GetRequestStream()\n\t$requestStream.Write($postStr, 0,$postStr.length)\n\t$requestStream.Close()\n\t\n\t[System.Net.WebResponse] $resp = $webRequest.GetResponse();\n\t$rs = $resp.GetResponseStream();\n\t[System.IO.StreamReader] $sr = New-Object System.IO.StreamReader -argumentList $rs;\n\t$sr.ReadToEnd();\t\t\t\t\t\n}\ncatch [Exception] {\n\t\"Woah!, wasn't expecting to get this exception. `r`n $_.Exception.ToString()\"\n}",
    "Octopus.Action.Script.Syntax": "PowerShell"
  },
  "Category": "HipChat",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/hipchat-notify-api-v1.json",
  "Website": "/step-templates/c37ccd22-2b31-4263-8389-9e63868519b4",
  "Logo": "https://i.octopus.com/library/step-templates/hipchat.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/hipchat-notify-api-v1.json)

</div>
