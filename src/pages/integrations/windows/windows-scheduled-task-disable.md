---
layout: src/layouts/Default.astro
pubDate: 2017-03-13
title: 'Windows Scheduled Task - Disable'
description: 'Disables a Windows Scheduled Task for both 2008 and 2012.'
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2017-03-13 by bobjwalker belongs to 'Windows' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Task Name

`TaskName`

Name of the Windows Scheduled Task.

</div>
        
<div class="param">

### Maximum Wait Time

`MaximumWaitTime = 0`

Maximum time the script must wait before aborting. Use '0' to wait indefinitely.

</div>
        
<div class="param">

### Succeed On Task Not Found

`SucceedOnTaskNotFound = `

This setting prevents the script from throwing an error if the task is not found.

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```PowerShell
$taskName = $OctopusParameters['TaskName']
$maximumWaitTime = $OctopusParameters['MaximumWaitTime']
$succeedOnTaskNotFound = $OctopusParameters['SucceedOnTaskNotFound']

#Check if the PowerShell cmdlets are available
$cmdletSupported = [bool](Get-Command -Name Get-ScheduledTask -ErrorAction SilentlyContinue)

try {
	if($cmdletSupported) {
		$taskExists = Get-ScheduledTask | Where-Object { $_.TaskName -eq $taskName }
	}
	else {
		$taskService = New-Object -ComObject "Schedule.Service"
		$taskService.Connect()
		$taskFolder = $taskService.GetFolder('\')
		$taskExists = $taskFolder.GetTasks(0) | Select-Object Name, State | Where-Object { $_.Name -eq $taskName }
	}

	if(-not $taskExists) {
        if( $succeedOnTaskNotFound){
            Write-Output "Scheduled task '$taskName' does not exist"
            }
        else {
		    throw "Scheduled task '$taskName' does not exist"
        }
		return
	}

	Write-Output "Disabling $taskName..."
	$waited = 0
	if($cmdletSupported) {
		$task = Disable-ScheduledTask $taskName
		Write-Output "Waiting until $taskName is disabled..."
		while(($task.State -ne [Microsoft.PowerShell.Cmdletization.GeneratedTypes.ScheduledTask.StateEnum]::Disabled) -and (($maximumWaitTime -eq 0) -or ($waited -lt $maximumWaitTime))) 
		{
			Start-Sleep -Milliseconds 200
			$waited += 200
			$task = Get-ScheduledTask $taskName
		}
		
		if($task.State -ne [Microsoft.PowerShell.Cmdletization.GeneratedTypes.ScheduledTask.StateEnum]::Disabled) {
			throw "The scheduled task $taskName could not be disabled within the specified wait time"
		}
	}
	else {
		schtasks /Change /Disable /TN "$taskName"
		#The State property can hold the following values:
		# 0: Unknown
		# 1: Disabled
		# 2: Queued
		# 3: Ready
		# 4: Running
		while(($taskFolder.GetTask($taskName).State -ne 1) -and (($maximumWaitTime -eq 0) -or ($waited -lt $maximumWaitTime))) {
			Start-Sleep -Milliseconds 200
			$waited += 200
		}
		
		if($taskFolder.GetTask($taskName).State -ne 1) {
		    throw "The scheduled task '$taskName' could not be disabled within the specified wait time"
		}
	}
}
finally {
    if($taskFolder -ne $NULL) {
	    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($taskFolder)   
	}
	
	if($taskService -ne $NULL) {
	    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($taskService)   
	}
}
```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20Windows%20Scheduled%20Task%20-%20Disable&step-template=Windows%20Scheduled%20Task%20-%20Disable)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "1be30b21-ba58-4667-bff4-2d0ef9a806af",
  "Name": "Windows Scheduled Task - Disable",
  "Description": "Disables a Windows Scheduled Task for both 2008 and 2012.",
  "Version": 6,
  "ExportedAt": "2017-03-13T19:50:10.728Z",
  "ActionType": "Octopus.Script",
  "Author": "bobjwalker",
  "Parameters": [
    {
      "Name": "TaskName",
      "Label": "Task Name",
      "HelpText": "Name of the Windows Scheduled Task.",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "DefaultValue": null
    },
    {
      "Name": "MaximumWaitTime",
      "Label": "Maximum Wait Time",
      "HelpText": "Maximum time the script must wait before aborting. Use '0' to wait indefinitely.",
      "DefaultValue": 0,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "SucceedOnTaskNotFound",
      "Label": "Succeed On Task Not Found",
      "HelpText": "This setting prevents the script from throwing an error if the task is not found.",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "Checkbox"
      },
      "Links": {}
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptBody": "$taskName = $OctopusParameters['TaskName']\n$maximumWaitTime = $OctopusParameters['MaximumWaitTime']\n$succeedOnTaskNotFound = $OctopusParameters['SucceedOnTaskNotFound']\n\n#Check if the PowerShell cmdlets are available\n$cmdletSupported = [bool](Get-Command -Name Get-ScheduledTask -ErrorAction SilentlyContinue)\n\ntry {\n\tif($cmdletSupported) {\n\t\t$taskExists = Get-ScheduledTask | Where-Object { $_.TaskName -eq $taskName }\n\t}\n\telse {\n\t\t$taskService = New-Object -ComObject \"Schedule.Service\"\n\t\t$taskService.Connect()\n\t\t$taskFolder = $taskService.GetFolder('\\')\n\t\t$taskExists = $taskFolder.GetTasks(0) | Select-Object Name, State | Where-Object { $_.Name -eq $taskName }\n\t}\n\n\tif(-not $taskExists) {\n        if( $succeedOnTaskNotFound){\n            Write-Output \"Scheduled task '$taskName' does not exist\"\n            }\n        else {\n\t\t    throw \"Scheduled task '$taskName' does not exist\"\n        }\n\t\treturn\n\t}\n\n\tWrite-Output \"Disabling $taskName...\"\n\t$waited = 0\n\tif($cmdletSupported) {\n\t\t$task = Disable-ScheduledTask $taskName\n\t\tWrite-Output \"Waiting until $taskName is disabled...\"\n\t\twhile(($task.State -ne [Microsoft.PowerShell.Cmdletization.GeneratedTypes.ScheduledTask.StateEnum]::Disabled) -and (($maximumWaitTime -eq 0) -or ($waited -lt $maximumWaitTime))) \n\t\t{\n\t\t\tStart-Sleep -Milliseconds 200\n\t\t\t$waited += 200\n\t\t\t$task = Get-ScheduledTask $taskName\n\t\t}\n\t\t\n\t\tif($task.State -ne [Microsoft.PowerShell.Cmdletization.GeneratedTypes.ScheduledTask.StateEnum]::Disabled) {\n\t\t\tthrow \"The scheduled task $taskName could not be disabled within the specified wait time\"\n\t\t}\n\t}\n\telse {\n\t\tschtasks /Change /Disable /TN \"$taskName\"\n\t\t#The State property can hold the following values:\n\t\t# 0: Unknown\n\t\t# 1: Disabled\n\t\t# 2: Queued\n\t\t# 3: Ready\n\t\t# 4: Running\n\t\twhile(($taskFolder.GetTask($taskName).State -ne 1) -and (($maximumWaitTime -eq 0) -or ($waited -lt $maximumWaitTime))) {\n\t\t\tStart-Sleep -Milliseconds 200\n\t\t\t$waited += 200\n\t\t}\n\t\t\n\t\tif($taskFolder.GetTask($taskName).State -ne 1) {\n\t\t    throw \"The scheduled task '$taskName' could not be disabled within the specified wait time\"\n\t\t}\n\t}\n}\nfinally {\n    if($taskFolder -ne $NULL) {\n\t    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($taskFolder)   \n\t}\n\t\n\tif($taskService -ne $NULL) {\n\t    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($taskService)   \n\t}\n}",
    "Octopus.Action.Script.Syntax": "PowerShell"
  },
  "Category": "Windows",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/windows-scheduled-task-disable.json",
  "Website": "/step-templates/1be30b21-ba58-4667-bff4-2d0ef9a806af",
  "Logo": "https://i.octopus.com/library/step-templates/windows.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/windows-scheduled-task-disable.json)

</div>
