---
layout: src/layouts/Default.astro
pubDate: 2015-01-30
title: 'Windows  - Certificate Grant Read Access'
description: 'Grant read access to certificate for a specific user'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2015-01-30 by ARBNIK@skandianet.org belongs to 'Windows' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Certificate Name

`certCN`

The CN of the Certificate

</div>
        
<div class="param">

### User name

`userName`

The Windows user

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```powershell
# $certCN is the identifiying CN for the certificate you wish to work with
# The selection also sorts on Expiration date, just in case there are old expired certs still in the certificate store.
# Make sure we work with the most recent cert
    
    Try
    {
        $WorkingCert = Get-ChildItem CERT:\LocalMachine\My |where {$_.Subject -match $certCN} | sort $_.NotAfter -Descending | select -first 1 -erroraction STOP
        $TPrint = $WorkingCert.Thumbprint
        $rsaFile = $WorkingCert.PrivateKey.CspKeyContainerInfo.UniqueKeyContainerName
        if($TPrint){
            Write-Host "Found certificate named $certCN with thumbprint $TPrint"
        }
        else{
            throw "Error: unable to locate certificate for $($CertCN)"
        }
    }
    Catch
    {
      throw "Error: unable to locate certificate for $($CertCN)"
    }
    $keyPath = "$env:SystemDrive\ProgramData\Microsoft\Crypto\RSA\MachineKeys\"
    $fullPath=$keyPath+$rsaFile
    $acl=Get-Acl -Path $fullPath
    $permission=$userName,"Read","Allow"
    $accessRule=new-object System.Security.AccessControl.FileSystemAccessRule $permission
    $acl.AddAccessRule($accessRule)
    Try 
    {
        Write-Host "Granting read access for user $userName on $certCN"
     Set-Acl $fullPath $acl
      Write-Host "Success: ACL set on certificate"
    }
    Catch
    {
      throw "Error: unable to set ACL on certificate"
    }
```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20Windows%20%20-%20Certificate%20Grant%20Read%20Access&step-template=Windows%20%20-%20Certificate%20Grant%20Read%20Access)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "cf6f35bf-b3e0-4285-98be-dcb509ab2ef9",
  "Name": "Windows  - Certificate Grant Read Access",
  "Description": "Grant read access to certificate for a specific user",
  "Version": 12,
  "ExportedAt": "2015-01-30T14:39:14.212+00:00",
  "ActionType": "Octopus.Script",
  "Author": "ARBNIK@skandianet.org",
  "Parameters": [
    {
      "Name": "certCN",
      "Label": "Certificate Name",
      "HelpText": "The CN of the Certificate",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "userName",
      "Label": "User name",
      "HelpText": "The Windows user",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptBody": "# $certCN is the identifiying CN for the certificate you wish to work with\n# The selection also sorts on Expiration date, just in case there are old expired certs still in the certificate store.\n# Make sure we work with the most recent cert\n    \n    Try\n    {\n        $WorkingCert = Get-ChildItem CERT:\\LocalMachine\\My |where {$_.Subject -match $certCN} | sort $_.NotAfter -Descending | select -first 1 -erroraction STOP\n        $TPrint = $WorkingCert.Thumbprint\n        $rsaFile = $WorkingCert.PrivateKey.CspKeyContainerInfo.UniqueKeyContainerName\n        if($TPrint){\n            Write-Host \"Found certificate named $certCN with thumbprint $TPrint\"\n        }\n        else{\n            throw \"Error: unable to locate certificate for $($CertCN)\"\n        }\n    }\n    Catch\n    {\n      throw \"Error: unable to locate certificate for $($CertCN)\"\n    }\n    $keyPath = \"$env:SystemDrive\\ProgramData\\Microsoft\\Crypto\\RSA\\MachineKeys\\\"\n    $fullPath=$keyPath+$rsaFile\n    $acl=Get-Acl -Path $fullPath\n    $permission=$userName,\"Read\",\"Allow\"\n    $accessRule=new-object System.Security.AccessControl.FileSystemAccessRule $permission\n    $acl.AddAccessRule($accessRule)\n    Try \n    {\n        Write-Host \"Granting read access for user $userName on $certCN\"\n     Set-Acl $fullPath $acl\n      Write-Host \"Success: ACL set on certificate\"\n    }\n    Catch\n    {\n      throw \"Error: unable to set ACL on certificate\"\n    }",
    "Octopus.Action.Script.Syntax": "PowerShell"
  },
  "Category": "Windows",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/windows-certificate-grant-read-access.json",
  "Website": "/step-templates/cf6f35bf-b3e0-4285-98be-dcb509ab2ef9",
  "Logo": "https://i.octopus.com/library/step-templates/windows.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/windows-certificate-grant-read-access.json)

</div>
