---
layout: src/layouts/Default.astro
pubDate: 2014-05-16
title: 'Splunk - Forward File'
description: 'Configures splunk forwarding for the specified file. (The splunk forwarder service should be installed on the target server)'
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2014-05-16 by bobjwalker belongs to 'Splunk' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### File

`File`

The path to the file to forward

</div>
        
<div class="param">

### Index

`Index`

The Splunk index to forward to

</div>
        
<div class="param">

### App name

`AppName`

The application name outputting to the file

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```PowerShell
$file = $OctopusParameters['File']
$index = $OctopusParameters['Index']
$appName = $OctopusParameters['AppName']

# Enable splunk forwarding

Set-Service SplunkForwarder -startuptype Automatic

# Create log file

if(!(Test-Path "$file"))
{
    Write-Host "Creating new log file"
    New-Item "$file" -type File -Force
}
else
{
    Write-Host "Log file already exists"
}

# Create/prepare splunk forwarder directory

$appPath = "$env:ProgramFiles\SplunkUniversalForwarder\etc\apps\$appName\default"

if(Test-Path "$appPath")
{
    Write-Host "Splunk app directory already exists. Removing existing configs"
	
	# Remove-Item recursion does not work correctly - http://technet.microsoft.com/library/hh849765.aspx (-Recurse section)
    # Remove files first then directories (leaf -> root) so we don't get the recursion confirm popup
    Get-ChildItem $appPath -Recurse | Where { ! $_.PSIsContainer } | Remove-Item -Force
    Get-ChildItem $appPath -Recurse | Where { $_.PSIsContainer } | Sort @{ Expression = { $_.FullName.length } } -Descending | Remove-Item -Force
}
else
{
    Write-Host "Creating splunk app directory"
    New-Item "$appPath" -type Directory
}

# Create forwarder config

Write-Host "Creating splunk forwarder config"

$str = "[monitor://$file]`r`ndisabled = false`r`nfollowTail = 0`r`nsourcetype = $appName`r`nindex = $index"
New-Item "$appPath\inputs.conf" -type File -value $str

# Restart forwarder service

Write-Host "Restarting splunk forwarder"
Restart-Service "SplunkForwarder"
```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20Splunk%20-%20Forward%20File&step-template=Splunk%20-%20Forward%20File)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "0e5d7444-1be1-47c4-a776-ec0f51cf04b3",
  "Name": "Splunk - Forward File",
  "Description": "Configures splunk forwarding for the specified file. (The splunk forwarder service should be installed on the target server)",
  "Version": 3,
  "ExportedAt": "2014-05-16T10:27:19.192+00:00",
  "ActionType": "Octopus.Script",
  "Author": "bobjwalker",
  "Parameters": [
    {
      "Name": "File",
      "Label": "File",
      "HelpText": "The path to the file to forward",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "Index",
      "Label": "Index",
      "HelpText": "The Splunk index to forward to",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "AppName",
      "Label": "App name",
      "HelpText": "The application name outputting to the file",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptBody": "$file = $OctopusParameters['File']\n$index = $OctopusParameters['Index']\n$appName = $OctopusParameters['AppName']\n\n# Enable splunk forwarding\n\nSet-Service SplunkForwarder -startuptype Automatic\n\n# Create log file\n\nif(!(Test-Path \"$file\"))\n{\n    Write-Host \"Creating new log file\"\n    New-Item \"$file\" -type File -Force\n}\nelse\n{\n    Write-Host \"Log file already exists\"\n}\n\n# Create/prepare splunk forwarder directory\n\n$appPath = \"$env:ProgramFiles\\SplunkUniversalForwarder\\etc\\apps\\$appName\\default\"\n\nif(Test-Path \"$appPath\")\n{\n    Write-Host \"Splunk app directory already exists. Removing existing configs\"\n\t\n\t# Remove-Item recursion does not work correctly - http://technet.microsoft.com/library/hh849765.aspx (-Recurse section)\n    # Remove files first then directories (leaf -> root) so we don't get the recursion confirm popup\n    Get-ChildItem $appPath -Recurse | Where { ! $_.PSIsContainer } | Remove-Item -Force\n    Get-ChildItem $appPath -Recurse | Where { $_.PSIsContainer } | Sort @{ Expression = { $_.FullName.length } } -Descending | Remove-Item -Force\n}\nelse\n{\n    Write-Host \"Creating splunk app directory\"\n    New-Item \"$appPath\" -type Directory\n}\n\n# Create forwarder config\n\nWrite-Host \"Creating splunk forwarder config\"\n\n$str = \"[monitor://$file]`r`ndisabled = false`r`nfollowTail = 0`r`nsourcetype = $appName`r`nindex = $index\"\nNew-Item \"$appPath\\inputs.conf\" -type File -value $str\n\n# Restart forwarder service\n\nWrite-Host \"Restarting splunk forwarder\"\nRestart-Service \"SplunkForwarder\"",
    "Octopus.Action.Script.Syntax": "PowerShell"
  },
  "Category": "Splunk",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/splunk-forward-file.json",
  "Website": "/step-templates/0e5d7444-1be1-47c4-a776-ec0f51cf04b3",
  "Logo": "https://i.octopus.com/library/step-templates/splunk.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/splunk-forward-file.json)

</div>
