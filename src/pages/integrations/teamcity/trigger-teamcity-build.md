---
layout: src/layouts/Default.astro
pubDate: 2015-03-16
title: 'Trigger TeamCity Build'
description: 'Trigger a specific Team City build from an Octopus Deploy process.'
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2015-03-16 by bjorgvino belongs to 'TeamCity' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### null

`BuildConfigurationId`

The Id of the build configuration to trigger.

</div>
        
<div class="param">

### null

`TeamCityUrl`

The URL of the Team City server.
E.g. `http://teamcity.example.com`.

</div>
        
<div class="param">

### null

`TeamCityUsername = `

The username to use for accessing TeamCity.

</div>
        
<div class="param">

### null

`TeamCityPassword`

The password for the TeamCity user.

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```PowerShell
$buildConfId = $OctopusParameters['BuildConfigurationId']

$teamCityUrl = $OctopusParameters['TeamCityUrl']
$teamCityUsername = $OctopusParameters['TeamCityUsername']
$teamCityPassword = $OctopusParameters['TeamCityPassword']

$url = $teamCityUrl + '/httpAuth/app/rest/buildQueue'
$contentTemplate = '<build><buildType id="{0}"/></build>'
$content = $contentTemplate -f $buildConfId
$encodedContent = [System.Text.Encoding]::UTF8.GetBytes($content)

Write-Host "================================================================================"
Write-Host "Triggering build with Id $buildConfId in TeamCity. Server:" $teamCityUrl 
Write-Host "================================================================================"

$req = [System.Net.WebRequest]::Create($url)
$req.Credentials = new-object System.Net.NetworkCredential($teamCityUsername, $teamCityPassword)
$req.Method ="POST"
$req.ContentType = "application/xml"

$req.ContentLength = $encodedContent.length
$requestStream = $req.GetRequestStream()
$requestStream.Write($encodedContent, 0, $encodedContent.length)
$requestStream.Close()

$resp = $req.GetResponse()
$reader = new-object System.IO.StreamReader($resp.GetResponseStream())
$reader.ReadToEnd() | Write-Host

```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20Trigger%20TeamCity%20Build&step-template=Trigger%20TeamCity%20Build)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "22483ce2-1444-4c02-861c-fb9533959e16",
  "Name": "Trigger TeamCity Build",
  "Description": "Trigger a specific Team City build from an Octopus Deploy process.",
  "Version": 1,
  "ExportedAt": "2015-03-16T10:47:31.328+00:00",
  "ActionType": "Octopus.Script",
  "Author": "bjorgvino",
  "Parameters": [
    {
      "Name": "BuildConfigurationId",
      "Label": null,
      "HelpText": "The Id of the build configuration to trigger.",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "TeamCityUrl",
      "Label": null,
      "HelpText": "The URL of the Team City server.\nE.g. `http://teamcity.example.com`.",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "TeamCityUsername",
      "Label": null,
      "HelpText": "The username to use for accessing TeamCity.",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "TeamCityPassword",
      "Label": null,
      "HelpText": "The password for the TeamCity user.",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "Sensitive"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptBody": "$buildConfId = $OctopusParameters['BuildConfigurationId']\n\n$teamCityUrl = $OctopusParameters['TeamCityUrl']\n$teamCityUsername = $OctopusParameters['TeamCityUsername']\n$teamCityPassword = $OctopusParameters['TeamCityPassword']\n\n$url = $teamCityUrl + '/httpAuth/app/rest/buildQueue'\n$contentTemplate = '<build><buildType id=\"{0}\"/></build>'\n$content = $contentTemplate -f $buildConfId\n$encodedContent = [System.Text.Encoding]::UTF8.GetBytes($content)\n\nWrite-Host \"================================================================================\"\nWrite-Host \"Triggering build with Id $buildConfId in TeamCity. Server:\" $teamCityUrl \nWrite-Host \"================================================================================\"\n\n$req = [System.Net.WebRequest]::Create($url)\n$req.Credentials = new-object System.Net.NetworkCredential($teamCityUsername, $teamCityPassword)\n$req.Method =\"POST\"\n$req.ContentType = \"application/xml\"\n\n$req.ContentLength = $encodedContent.length\n$requestStream = $req.GetRequestStream()\n$requestStream.Write($encodedContent, 0, $encodedContent.length)\n$requestStream.Close()\n\n$resp = $req.GetResponse()\n$reader = new-object System.IO.StreamReader($resp.GetResponseStream())\n$reader.ReadToEnd() | Write-Host\n",
    "Octopus.Action.Script.Syntax": "PowerShell"
  },
  "Category": "TeamCity",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/teamcity-trigger-build.json",
  "Website": "/step-templates/22483ce2-1444-4c02-861c-fb9533959e16",
  "Logo": "https://i.octopus.com/library/step-templates/teamcity.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/teamcity-trigger-build.json)

</div>
