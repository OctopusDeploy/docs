---
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
layout: src/layouts/Default.astro
pubDate: 2017-02-24
title: 'Notification - Spark'
description: 'Send a message to Spark user or room'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
---

Octopus.Script exported 2017-02-24 by 2o1o0 belongs to 'Spark' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Message to send

`message`

Can use markdown notation

</div>
        
<div class="param">

### Authentication token

`auth_token`

Bot token

</div>
        
<div class="param">

### API URL

`api_uri = https://api.ciscospark.com/v1`

null

</div>
        
<div class="param">

### Proxy

`proxy = `

Proxy address

</div>
        
<div class="param">

### Contact Method

`contactmethod = `

null

</div>
        
<div class="param">

### Contact Details

`contactdetails`

Enter contact details depending on Contact Method choice. Set multiple entries with ','.

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```powershell
function send-sparkmessage
{
<#
	.SYNOPSIS
		Send a message to a spark user
	
	.DESCRIPTION
		A detailed description of the send-sparkmessagetouser function.
	
	.PARAMETER useremail
		user email
	
	.PARAMETER message
		Message to send to the user. Can use markdown.
	
	.PARAMETER auth_token
		OAuth token
	
	.PARAMETER api_uri
		API url if different from default (https://api.ciscospark.com/v1)
	
	.PARAMETER userid
		user id
	
	.PARAMETER proxy
		proxy url
	
	.PARAMETER roomid
		A description of the roomid parameter.
	
	.PARAMETER room_id
		Id for room to send message to.
	
	.NOTES
		Additional information about the function.
#>
	
	param
	(
		[Parameter(ParameterSetName = 'toPersonEmail',
				   Mandatory = $true,
				   HelpMessage = 'User email to contact')]
		[string]$useremail,
		[Parameter(Mandatory = $true,
				   HelpMessage = 'Set a message to send to the user. Can use markdown.')]
		[string]$message,
		[Parameter(Mandatory = $true,
				   HelpMessage = 'Set OAuth token')]
		[string]$auth_token,
		[Parameter(Mandatory = $false,
				   HelpMessage = 'API url if different from default.')]
		[uri]$api_uri = "https://api.ciscospark.com/v1",
		[Parameter(ParameterSetName = 'toPersonID',
				   Mandatory = $true)]
		[string]$userid,
		[string]$proxy,
		[Parameter(ParameterSetName = 'toRoomID',
				   Mandatory = $true)]
		[string]$roomid
	)
	
	$header = @{ 'Authorization' = " Bearer $auth_token" }
	
	switch ($PsCmdlet.ParameterSetName)
	{
		"toPersonEmail" {
			$body = @{
				toPersonEmail = $useremail
				markdown = $message
			}
		}
		"toPersonID" {
			$body = @{
				toPersonId = $userid
				markdown = $message
			}
		}
		"toRoomID"{
			$body = @{
				roomId = $roomid
				markdown = $message
			}
		}
		
	}
	
	if ($proxy)
	{
		Invoke-RestMethod -Uri "$api_uri/messages" -Method Post -headers $header -Body (ConvertTo-Json $body) -ContentType "application/json" -Proxy $proxy
	}
	else
	{
		Invoke-RestMethod -Uri "$api_uri/messages" -Method Post -headers $header -Body (ConvertTo-Json $body) -ContentType "application/json"
	}
}


$useremail = $OctopusParameters['useremail']
$message = $OctopusParameters['message']
$auth_token = $OctopusParameters['auth_token']
$proxy = $OctopusParameters['proxy']
$contactmethod = $OctopusParameters['contactmethod']
$contactdetails = $OctopusParameters['contactdetails']

Write-Verbose "contact details : $contactdetails"
Write-Verbose "contact method : $contactmethod"
Write-Verbose "message : $message"
Write-Verbose "proxy: $proxy"
foreach ($contactdetail in $contactdetails.Replace(" ", "").Split(","))
{
	switch ($contactmethod)
	{
		"useremail" {
			if ($proxy)
			{
				Write-Host "Sending Spark message via $contactmethod to $contactdetail"
				send-sparkmessage -useremail $contactdetail -message $message -auth_token $auth_token -proxy $proxy
			}
			else
			{
				Write-Host "Sending Spark message via $contactmethod to $contactdetail"
				send-sparkmessage -useremail $contactdetail -message $message -auth_token $auth_token
			}
		}
		
		
		"userid" {
			if ($proxy)
			{
				Write-Host "Sending Spark message via $contactmethod to $contactdetail"
				send-sparkmessage -userid $contactdetail -message $message -auth_token $auth_token -proxy $proxy
			}
			else
			{
				Write-Host "Sending Spark message via $contactmethod to $contactdetail"
				send-sparkmessage -userid $contactdetail -message $message -auth_token $auth_token
			}
		}
		
		"roomid"{
			if ($proxy)
			{
				Write-Host "Sending Spark message via $contactmethod to $contactdetail"
				send-sparkmessage -roomid $contactdetail -message $message -auth_token $auth_token -proxy $proxy
			}
			else
			{
				Write-Host "Sending Spark message via $contactmethod to $contactdetail"
				send-sparkmessage -roomid $contactdetail -message $message -auth_token $auth_token
			}
		}
	}
	
}

```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20Notification%20-%20Spark&step-template=Notification%20-%20Spark)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "cab1e42d-6b8e-4e3e-980d-82fc8e0e2178",
  "Name": "Notification - Spark",
  "Description": "Send a message to Spark user or room",
  "Version": 16,
  "ExportedAt": "2017-02-24T10:38:27.080Z",
  "ActionType": "Octopus.Script",
  "Author": "2o1o0",
  "Parameters": [
    {
      "Id": "01f83e29-94e6-4fbb-aef5-065a08243d6f",
      "Name": "message",
      "Label": "Message to send",
      "HelpText": "Can use markdown notation",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "MultiLineText"
      },
      "Links": {}
    },
    {
      "Id": "d0a2f4f0-61dc-4e04-8d5e-b421f0fe64a3",
      "Name": "auth_token",
      "Label": "Authentication token",
      "HelpText": "Bot token",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "Sensitive"
      },
      "Links": {}
    },
    {
      "Id": "4ae608b1-d659-45d0-b377-223edea6e520",
      "Name": "api_uri",
      "Label": "API URL",
      "HelpText": null,
      "DefaultValue": "https://api.ciscospark.com/v1",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "1c1ca24b-cd7e-4b77-90d0-5cd2d8ad8a74",
      "Name": "proxy",
      "Label": "Proxy",
      "HelpText": "Proxy address",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "b5c9688f-d899-4356-ac65-aaa098dd48a7",
      "Name": "contactmethod",
      "Label": "Contact Method",
      "HelpText": null,
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "Select",
        "Octopus.SelectOptions": "useremail|User Email\nuserid|User ID\nroomid|Room ID"
      },
      "Links": {}
    },
    {
      "Id": "b26814c8-7a05-4a04-bcc6-073691df972b",
      "Name": "contactdetails",
      "Label": "Contact Details",
      "HelpText": "Enter contact details depending on Contact Method choice. Set multiple entries with ','.",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    }
  ],
  "Properties": {
    "Octopus.Action.Script.Syntax": "PowerShell",
    "Octopus.Action.Script.ScriptSource": "Inline",
    "Octopus.Action.RunOnServer": "false",
    "Octopus.Action.Script.ScriptBody": "function send-sparkmessage\n{\n<#\n\t.SYNOPSIS\n\t\tSend a message to a spark user\n\t\n\t.DESCRIPTION\n\t\tA detailed description of the send-sparkmessagetouser function.\n\t\n\t.PARAMETER useremail\n\t\tuser email\n\t\n\t.PARAMETER message\n\t\tMessage to send to the user. Can use markdown.\n\t\n\t.PARAMETER auth_token\n\t\tOAuth token\n\t\n\t.PARAMETER api_uri\n\t\tAPI url if different from default (https://api.ciscospark.com/v1)\n\t\n\t.PARAMETER userid\n\t\tuser id\n\t\n\t.PARAMETER proxy\n\t\tproxy url\n\t\n\t.PARAMETER roomid\n\t\tA description of the roomid parameter.\n\t\n\t.PARAMETER room_id\n\t\tId for room to send message to.\n\t\n\t.NOTES\n\t\tAdditional information about the function.\n#>\n\t\n\tparam\n\t(\n\t\t[Parameter(ParameterSetName = 'toPersonEmail',\n\t\t\t\t   Mandatory = $true,\n\t\t\t\t   HelpMessage = 'User email to contact')]\n\t\t[string]$useremail,\n\t\t[Parameter(Mandatory = $true,\n\t\t\t\t   HelpMessage = 'Set a message to send to the user. Can use markdown.')]\n\t\t[string]$message,\n\t\t[Parameter(Mandatory = $true,\n\t\t\t\t   HelpMessage = 'Set OAuth token')]\n\t\t[string]$auth_token,\n\t\t[Parameter(Mandatory = $false,\n\t\t\t\t   HelpMessage = 'API url if different from default.')]\n\t\t[uri]$api_uri = \"https://api.ciscospark.com/v1\",\n\t\t[Parameter(ParameterSetName = 'toPersonID',\n\t\t\t\t   Mandatory = $true)]\n\t\t[string]$userid,\n\t\t[string]$proxy,\n\t\t[Parameter(ParameterSetName = 'toRoomID',\n\t\t\t\t   Mandatory = $true)]\n\t\t[string]$roomid\n\t)\n\t\n\t$header = @{ 'Authorization' = \" Bearer $auth_token\" }\n\t\n\tswitch ($PsCmdlet.ParameterSetName)\n\t{\n\t\t\"toPersonEmail\" {\n\t\t\t$body = @{\n\t\t\t\ttoPersonEmail = $useremail\n\t\t\t\tmarkdown = $message\n\t\t\t}\n\t\t}\n\t\t\"toPersonID\" {\n\t\t\t$body = @{\n\t\t\t\ttoPersonId = $userid\n\t\t\t\tmarkdown = $message\n\t\t\t}\n\t\t}\n\t\t\"toRoomID\"{\n\t\t\t$body = @{\n\t\t\t\troomId = $roomid\n\t\t\t\tmarkdown = $message\n\t\t\t}\n\t\t}\n\t\t\n\t}\n\t\n\tif ($proxy)\n\t{\n\t\tInvoke-RestMethod -Uri \"$api_uri/messages\" -Method Post -headers $header -Body (ConvertTo-Json $body) -ContentType \"application/json\" -Proxy $proxy\n\t}\n\telse\n\t{\n\t\tInvoke-RestMethod -Uri \"$api_uri/messages\" -Method Post -headers $header -Body (ConvertTo-Json $body) -ContentType \"application/json\"\n\t}\n}\n\n\n$useremail = $OctopusParameters['useremail']\n$message = $OctopusParameters['message']\n$auth_token = $OctopusParameters['auth_token']\n$proxy = $OctopusParameters['proxy']\n$contactmethod = $OctopusParameters['contactmethod']\n$contactdetails = $OctopusParameters['contactdetails']\n\nWrite-Verbose \"contact details : $contactdetails\"\nWrite-Verbose \"contact method : $contactmethod\"\nWrite-Verbose \"message : $message\"\nWrite-Verbose \"proxy: $proxy\"\nforeach ($contactdetail in $contactdetails.Replace(\" \", \"\").Split(\",\"))\n{\n\tswitch ($contactmethod)\n\t{\n\t\t\"useremail\" {\n\t\t\tif ($proxy)\n\t\t\t{\n\t\t\t\tWrite-Host \"Sending Spark message via $contactmethod to $contactdetail\"\n\t\t\t\tsend-sparkmessage -useremail $contactdetail -message $message -auth_token $auth_token -proxy $proxy\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tWrite-Host \"Sending Spark message via $contactmethod to $contactdetail\"\n\t\t\t\tsend-sparkmessage -useremail $contactdetail -message $message -auth_token $auth_token\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t\"userid\" {\n\t\t\tif ($proxy)\n\t\t\t{\n\t\t\t\tWrite-Host \"Sending Spark message via $contactmethod to $contactdetail\"\n\t\t\t\tsend-sparkmessage -userid $contactdetail -message $message -auth_token $auth_token -proxy $proxy\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tWrite-Host \"Sending Spark message via $contactmethod to $contactdetail\"\n\t\t\t\tsend-sparkmessage -userid $contactdetail -message $message -auth_token $auth_token\n\t\t\t}\n\t\t}\n\t\t\n\t\t\"roomid\"{\n\t\t\tif ($proxy)\n\t\t\t{\n\t\t\t\tWrite-Host \"Sending Spark message via $contactmethod to $contactdetail\"\n\t\t\t\tsend-sparkmessage -roomid $contactdetail -message $message -auth_token $auth_token -proxy $proxy\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tWrite-Host \"Sending Spark message via $contactmethod to $contactdetail\"\n\t\t\t\tsend-sparkmessage -roomid $contactdetail -message $message -auth_token $auth_token\n\t\t\t}\n\t\t}\n\t}\n\t\n}\n",
    "Octopus.Action.Script.ScriptFileName": null,
    "Octopus.Action.Package.FeedId": null,
    "Octopus.Action.Package.PackageId": null
  },
  "Category": "Spark",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/spark-sendnotification.json",
  "Website": "/step-templates/cab1e42d-6b8e-4e3e-980d-82fc8e0e2178",
  "Logo": "https://i.octopus.com/library/step-templates/spark.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/spark-sendnotification.json)

</div>
