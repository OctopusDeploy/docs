---
layout: src/layouts/Default.astro
pubDate: 2020-08-11
title: 'ASP.NET Core Set Environment Variables Via IIS Config'
description: 'Set environment variables in IIS config (no web.config)'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2020-08-11 by waxtell belongs to '.NET Core' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Site Name

`sev_siteName = `

Name of your ASP.NET Core site

</div>
        
<div class="param">

### Environment Variables

`sev_envVariables = `

Newline separated list of environment variables (varname=varvalue)

</div>
        
<div class="param">

### Path to appcmd.exe

`sev_appCmdPath = c:\windows\system32\inetsrv`

Path to the appcmd.exe executable

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```powershell
function AddOrReplaceEnvironmentVariable {
    param
    (
        [string] $variableName, 
        [string] $variableValue,
        [string] $siteName,
        [string] $appCmd
    )

    Try {
        [xml] $xmlConfig = (&$appCmd list config $sev_siteName -section:system.webServer/aspNetCore)
    }
    Catch {
        Write-Host $sev_siteName 'either does not exist or is not an AspNetCore site!'
        exit -1
    }

    if($xmlConfig.selectNodes("//environmentVariable[@name='$variableName']")) {
        &$appCmd set config $sev_siteName -section:system.webServer/aspNetCore /-"environmentVariables.[name='$variableName',value='$variableValue']" /commit:apphost
    }
    
    &$appCmd set config $sev_siteName -section:system.webServer/aspNetCore /+"environmentVariables.[name='$variableName',value='$variableValue']" /commit:apphost
}

[string] $sev_siteName=$OctopusParameters['sev_siteName']
[string] $sev_envVariables=$OctopusParameters['sev_envVariables']
[string] $sev_appCmdPath=$OctopusParameters['sev_appCmdPath']

Write-Host "---------------------------"
Write-Host $sev_envVariables
Write-Host $sev_appCmdPath
Write-Host "---------------------------"

$appCmd = Join-Path $sev_appCmdPath 'appcmd.exe'

foreach($line in $sev_envVariables -split '\r?\n') {
    $keyValuePair = $line -split '='

    AddOrReplaceEnvironmentVariable $keyValuePair[0] $keyValuePair[1] $sev_siteName $appCmd
}

```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20ASP.NET%20Core%20Set%20Environment%20Variables%20Via%20IIS%20Config&step-template=ASP.NET%20Core%20Set%20Environment%20Variables%20Via%20IIS%20Config)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "3586C580-7FC8-4FAB-A783-3641D91F7746",
  "Name": "ASP.NET Core Set Environment Variables Via IIS Config",
  "Description": "Set environment variables in IIS config (no web.config)",
  "Version": 1,
  "ExportedAt": "2020-08-11T17:06:34.462Z",
  "ActionType": "Octopus.Script",
  "Author": "waxtell",
  "Packages": [],
  "Parameters": [
    {
      "Id": "3FE22421-50AB-4CBB-B86A-666EC1609115",
      "Name": "sev_siteName",
      "Label": "Site Name",
      "HelpText": "Name of your ASP.NET Core site",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "78BF70F2-72F5-42E6-A992-C9504A964815",
      "Name": "sev_envVariables",
      "Label": "Environment Variables",
      "HelpText": "Newline separated list of environment variables (varname=varvalue)",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "MultiLineText"
      }
    },
    {
      "Id": "3F851D0C-C93E-403F-861E-5BDA361C1E92",
      "Name": "sev_appCmdPath",
      "Label": "Path to appcmd.exe",
      "HelpText": "Path to the appcmd.exe executable",
      "DefaultValue": "c:\\windows\\system32\\inetsrv",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptBody": "function AddOrReplaceEnvironmentVariable {\n    param\n    (\n        [string] $variableName, \n        [string] $variableValue,\n        [string] $siteName,\n        [string] $appCmd\n    )\n\n    Try {\n        [xml] $xmlConfig = (&$appCmd list config $sev_siteName -section:system.webServer/aspNetCore)\n    }\n    Catch {\n        Write-Host $sev_siteName 'either does not exist or is not an AspNetCore site!'\n        exit -1\n    }\n\n    if($xmlConfig.selectNodes(\"//environmentVariable[@name='$variableName']\")) {\n        &$appCmd set config $sev_siteName -section:system.webServer/aspNetCore /-\"environmentVariables.[name='$variableName',value='$variableValue']\" /commit:apphost\n    }\n    \n    &$appCmd set config $sev_siteName -section:system.webServer/aspNetCore /+\"environmentVariables.[name='$variableName',value='$variableValue']\" /commit:apphost\n}\n\n[string] $sev_siteName=$OctopusParameters['sev_siteName']\n[string] $sev_envVariables=$OctopusParameters['sev_envVariables']\n[string] $sev_appCmdPath=$OctopusParameters['sev_appCmdPath']\n\nWrite-Host \"---------------------------\"\nWrite-Host $sev_envVariables\nWrite-Host $sev_appCmdPath\nWrite-Host \"---------------------------\"\n\n$appCmd = Join-Path $sev_appCmdPath 'appcmd.exe'\n\nforeach($line in $sev_envVariables -split '\\r?\\n') {\n    $keyValuePair = $line -split '='\n\n    AddOrReplaceEnvironmentVariable $keyValuePair[0] $keyValuePair[1] $sev_siteName $appCmd\n}\n",
    "Octopus.Action.Script.Syntax": "PowerShell",
    "Octopus.Action.Script.ScriptSource": "Inline",
    "Octopus.Action.RunOnServer": "false"
  },
  "Category": ".NET Core",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/aspnetcore-set-environment-variable-iis.json",
  "Website": "/step-templates/3586C580-7FC8-4FAB-A783-3641D91F7746",
  "Logo": "https://i.octopus.com/library/step-templates/dotnetcore.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/aspnetcore-set-environment-variable-iis.json)

</div>
