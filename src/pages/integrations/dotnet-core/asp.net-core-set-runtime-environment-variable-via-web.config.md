---
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
layout: src/layouts/Default.astro
pubDate: 2017-08-31
title: 'ASP.NET Core - set runtime environment variable via web.config'
description: 'ASP.NET Core allows you specify environment variables in web.config - https://docs.microsoft.com/en-us/aspnet/core/hosting/aspnet-core-module#set-environment-variables'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
---

Octopus.Script exported 2017-08-31 by baynenator belongs to '.NET Core' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Web.Config Path

`anc_WebConfigPath = `

Typically an output variable from a previous step

</div>
        
<div class="param">

### Environment Variable Name

`anc_EnvironmentVariableName = `

Name of environment variable to set

</div>
        
<div class="param">

### Environment Variable Value

`anc_EnvironmentVariableValue = `

Value of environment variable to set

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```powershell
Param(
    [string]$anc_WebConfigPath,
    [string]$anc_EnvironmentVariableName,
    [string]$anc_EnvironmentVariableValue
)

$ErrorActionPreference = "Stop"

function Get-Parameter($Name, [switch]$Required, [switch]$TestPath) {

    $result = $null

    if ($OctopusParameters -ne $null) {
        $result = $OctopusParameters[$Name]
    }

    if ($result -eq $null) {
        $variable = Get-Variable $Name
        if ($variable -ne $null) {
            $result = $variable.Value
        }
    }

    if ($result -eq $null -or $result -eq "") {
        if ($Required) {
            throw "Missing parameter value $Name"
        }
    }

    if ($TestPath) {
        if (!(Test-Path $result -PathType Leaf)) {
            throw "Could not find $result"
        }
    }

    return $result
}

& {
    Param(
        [string]$anc_WebConfigPath,
        [string]$anc_EnvironmentVariableName,
        [string]$anc_EnvironmentVariableValue
    )

    $xml = (Get-Content $anc_WebConfigPath) -as [Xml]
    $aspNetCore = $xml.configuration.location.'system.webServer'.aspNetCore
    $environmentVariables = $aspNetCore.environmentVariables

    if (!$environmentVariables) {
        $environmentVariables = $xml.CreateElement("environmentVariables");
        $aspNetCore.AppendChild($environmentVariables)
    }

    $environmentVariable = $environmentVariables.environmentVariable | Where-Object {$_.name -eq $anc_EnvironmentVariableName}

    if ($environmentVariable) {
        $environmentVariable.value = $anc_EnvironmentVariableValue
    }
    elseif ($environmentVariables) {
        $environmentVariable = $xml.CreateElement("environmentVariable");
        $environmentVariable.SetAttribute("name", $anc_EnvironmentVariableName);
        $environmentVariable.SetAttribute("value", $anc_EnvironmentVariableValue);
        $x = $environmentVariables.AppendChild($environmentVariable)
    }
    else {
        throw "Could not find 'configuration/system.webServer/aspNetCore/environmentVariables' element in web.config"
    }

    try {
        $xml.Save((Resolve-Path $anc_WebConfigPath))
    }
    catch {
        throw "Could not save web.config because: $_.Exception.Message"
    }
} `
(Get-Parameter 'anc_WebConfigPath' -Required -TestPath) `
(Get-Parameter 'anc_EnvironmentVariableName' -Required) `
(Get-Parameter 'anc_EnvironmentVariableValue' -Required)

```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20ASP.NET%20Core%20-%20set%20runtime%20environment%20variable%20via%20web.config&step-template=ASP.NET%20Core%20-%20set%20runtime%20environment%20variable%20via%20web.config)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "c7f96ab8-a0d3-4f01-928e-c8cb78ab108c",
  "Name": "ASP.NET Core - set runtime environment variable via web.config",
  "Description": "ASP.NET Core allows you specify environment variables in web.config - https://docs.microsoft.com/en-us/aspnet/core/hosting/aspnet-core-module#set-environment-variables",
  "Version": 3,
  "ExportedAt": "2017-08-31T06:20:39.415Z",
  "ActionType": "Octopus.Script",
  "Author": "baynenator",
  "Parameters": [
    {
      "Id": "b1b74503-0f3d-4519-8ec6-d6a4aace9086",
      "Name": "anc_WebConfigPath",
      "Label": "Web.Config Path",
      "HelpText": "Typically an output variable from a previous step",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "5fe18f04-de84-445e-bb69-81ed0d39980f",
      "Name": "anc_EnvironmentVariableName",
      "Label": "Environment Variable Name",
      "HelpText": "Name of environment variable to set",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    },
    {
      "Id": "c9099a01-7de3-4724-8d6d-e26d8bf0fd21",
      "Name": "anc_EnvironmentVariableValue",
      "Label": "Environment Variable Value",
      "HelpText": "Value of environment variable to set",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    }
  ],
  "Properties": {
    "Octopus.Action.Script.Syntax": "PowerShell",
    "Octopus.Action.Script.ScriptSource": "Inline",
    "Octopus.Action.RunOnServer": "false",
    "Octopus.Action.Script.ScriptBody": "Param(\n    [string]$anc_WebConfigPath,\n    [string]$anc_EnvironmentVariableName,\n    [string]$anc_EnvironmentVariableValue\n)\n\n$ErrorActionPreference = \"Stop\"\n\nfunction Get-Parameter($Name, [switch]$Required, [switch]$TestPath) {\n\n    $result = $null\n\n    if ($OctopusParameters -ne $null) {\n        $result = $OctopusParameters[$Name]\n    }\n\n    if ($result -eq $null) {\n        $variable = Get-Variable $Name\n        if ($variable -ne $null) {\n            $result = $variable.Value\n        }\n    }\n\n    if ($result -eq $null -or $result -eq \"\") {\n        if ($Required) {\n            throw \"Missing parameter value $Name\"\n        }\n    }\n\n    if ($TestPath) {\n        if (!(Test-Path $result -PathType Leaf)) {\n            throw \"Could not find $result\"\n        }\n    }\n\n    return $result\n}\n\n& {\n    Param(\n        [string]$anc_WebConfigPath,\n        [string]$anc_EnvironmentVariableName,\n        [string]$anc_EnvironmentVariableValue\n    )\n\n    $xml = (Get-Content $anc_WebConfigPath) -as [Xml]\n    $aspNetCore = $xml.configuration.location.'system.webServer'.aspNetCore\n    $environmentVariables = $aspNetCore.environmentVariables\n\n    if (!$environmentVariables) {\n        $environmentVariables = $xml.CreateElement(\"environmentVariables\");\n        $aspNetCore.AppendChild($environmentVariables)\n    }\n\n    $environmentVariable = $environmentVariables.environmentVariable | Where-Object {$_.name -eq $anc_EnvironmentVariableName}\n\n    if ($environmentVariable) {\n        $environmentVariable.value = $anc_EnvironmentVariableValue\n    }\n    elseif ($environmentVariables) {\n        $environmentVariable = $xml.CreateElement(\"environmentVariable\");\n        $environmentVariable.SetAttribute(\"name\", $anc_EnvironmentVariableName);\n        $environmentVariable.SetAttribute(\"value\", $anc_EnvironmentVariableValue);\n        $x = $environmentVariables.AppendChild($environmentVariable)\n    }\n    else {\n        throw \"Could not find 'configuration/system.webServer/aspNetCore/environmentVariables' element in web.config\"\n    }\n\n    try {\n        $xml.Save((Resolve-Path $anc_WebConfigPath))\n    }\n    catch {\n        throw \"Could not save web.config because: $_.Exception.Message\"\n    }\n} `\n(Get-Parameter 'anc_WebConfigPath' -Required -TestPath) `\n(Get-Parameter 'anc_EnvironmentVariableName' -Required) `\n(Get-Parameter 'anc_EnvironmentVariableValue' -Required)\n",
    "Octopus.Action.Script.ScriptFileName": null,
    "Octopus.Action.Package.FeedId": null,
    "Octopus.Action.Package.PackageId": null
  },
  "Category": ".NET Core",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/aspnetcore-set-environment-variable.json",
  "Website": "/step-templates/c7f96ab8-a0d3-4f01-928e-c8cb78ab108c",
  "Logo": "https://i.octopus.com/library/step-templates/dotnetcore.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/aspnetcore-set-environment-variable.json)

</div>
