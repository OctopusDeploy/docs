---
layout: src/layouts/Default.astro
pubDate: 2021-10-05
title: 'Import Databricks Workbooks'
description: 'Import Databricks workbooks (current supported files `.ipynb` and `.scala`) to a databricks instance'
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2021-10-05 by Zogamorph belongs to 'Databricks' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### DataBricks WorkBook Package

`DeployDataBricksWorkBookPackage = `

The Databricks workbook package

</div>
        
<div class="param">

### Databricks Instance Uri

`DataBricksInstanceUri = `

The Databricks Instance URL

</div>
        
<div class="param">

### Databricks Access Token

`DataBricksAccessToken = `

The access token to authenticate against the Databricks instance

</div>
        
<div class="param">

### Databricks Workbook Import Folder

`DatabricksImportFolder = /`

Databricks Workbook import folder location

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```PowerShell
$ErrorActionPreference = "Stop" #region fucntions
function Set-DatabricksWorkBook
{
    [CmdletBinding()]
    param (
        [Parameter()]
        [String]
        $AccessToken, 
        [Parameter()]
        [String]
        $DataBricksInstanceUri,
        [Parameter()]
        [String]
        $WorkbooksUploadPath,
        [Parameter()]
        [String]
        $DatabrickImportFolder
    )

    $headers = @{
        'Authorization' = ("Bearer {0}" -f $AccessToken )
    }
    $APIVersion = '/api/2.0'
    $APICommand = '/workspace/import'
    $Uri = "https://$DataBricksInstanceUri$APIVersion$APICommand"
        
    Get-ChildItem -Path $WorkbooksUploadPath -Recurse -File | ForEach-Object{ $currentWorkBook = $_
        Write-Host ("Importing Workbook:{0}" -f $currentWorkBook.FullName)
 		$workbookContent =  [Convert]::ToBase64String((Get-Content -path $currentWorkBook.FullName -Encoding byte))
    
        if($DatabrickImportFolder.EndsWith("/"))
    	{
    		$workbookPath   = "{0}{1}" -f $DatabrickImportFolder , $currentWorkBook.BaseName
    	}
    	else 
    	{
        	$workbookPath   = "{0}/{1}" -f $DatabrickImportFolder , $currentWorkBook.BaseName
    	}
        
        switch ($currentWorkBook.Extension.ToLower()) 
        {
            '.ipynb' { 
                $workbookLanguage = "PYTHON" 
                $workbookFormat   = "JUPYTER"
                break
            }
            '.scala' {
                $workbookLanguage = "SCALA"
                $workbookFormat   = "SOURCE"
                break
        }
        Default 
            {
                $workbookLanguage = "SQL"
                $workbookFormat   = "SOURCE"
            }
        }
        $requestBody = ConvertTo-Json -InputObject @{ 
            content = $workbookContent
            path = $workbookPath
            language = $workbookLanguage
            format = $workbookFormat
            overwrite = $true
            }
        
        $apiResponse = Invoke-RestMethod -Method Post  -Uri  $Uri -Headers $headers -Body $requestBody
        return $apiResponse
    }
}


function Set-DatabricksWorkspaceFolder
{
    [CmdletBinding()]
    param (
        [Parameter()]
        [String]
        $AccessToken, 
        [Parameter()]
        [String]
        $DataBricksInstanceUri,
        [Parameter()]
        [String]
        $DatabrickFolder
    )

    $headers = @{
        'Authorization' = ("Bearer {0}" -f $AccessToken )
    }
    $APIVersion = '/api/2.0'
    $APIListCommand = '/workspace/list'
    $APIMkdirsCommand = '/workspace/mkdirs'
    $ListUri = "https://$DataBricksInstanceUri$APIVersion$APIListCommand"
    $MkdirsUri = "https://$DataBricksInstanceUri$APIVersion$APIMkdirsCommand"

    $pathRoute = $DatabrickFolder.Substring(1) -split '/'
    $basePath = "/"
    foreach($path in $pathRoute)
    {
        $requestBody = @{ 
            path = $basePath
        }
        $apiResponse = Invoke-RestMethod -Uri $ListUri -Headers $headers -Body $requestBody -ContentType application/json  
        $workSpaceFolder = $apiResponse.objects | Where-Object {$_.object_type -eq "DIRECTORY" -and $_.path -eq ( "{0}{1}" -f $basePath , $path) } 
        if($null -eq $workSpaceFolder)
        {
            $requestBody = ConvertTo-Json -InputObject  @{ 
                path = ( "{0}{1}" -f $basePath , $path)
            } 
            Invoke-RestMethod -Method Post -Uri $MkdirsUri -Headers $headers -Body $requestBody
        }
        $basePath = "{0}/{1}/" -f $basePath , $path
        if($basePath.StartsWith("//"))
        {
            $basePath = $basePath.Substring(1)
        }
    }
}

#endregion fucntions


$DatabrickWorkBookImportFolder = $OctopusParameters["Octopus.Action.Package[DeployDataBricksWorkBookPackage].ExtractedPath"]

Write-Host "Checking WorkSpace Folders"
Set-DatabricksWorkspaceFolder  -AccessToken $DataBricksAccessToken -DataBricksInstanceUri $DataBricksInstanceUri -DatabrickFolder $DatabricksImportFolder
Write-Host "Importing Databricks Workbooks"
Set-DatabricksWorkBook -AccessToken $DataBricksAccessToken -DataBricksInstanceUri $DataBricksInstanceUri -WorkbooksUploadPath $DatabrickWorkBookImportFolder -DatabrickImportFolder $DatabricksImportFolder

```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20Import%20Databricks%20Workbooks&step-template=Import%20Databricks%20Workbooks)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "0bbe289c-3ea9-47f8-970c-caa946878f49",
  "Name": "Import Databricks Workbooks",
  "Description": "Import Databricks workbooks (current supported files `.ipynb` and `.scala`) to a databricks instance",
  "Version": 1,
  "ExportedAt": "2021-10-05T09:38:27.445Z",
  "ActionType": "Octopus.Script",
  "Author": "Zogamorph",
  "Packages": [
    {
      "Id": "7885715a-c3e8-492a-ba61-23c34d2e9447",
      "Name": "DeployDataBricksWorkBookPackage",
      "PackageId": null,
      "FeedId": null,
      "AcquisitionLocation": "Server",
      "Properties": {
        "Extract": "True",
        "SelectionMode": "deferred",
        "PackageParameterName": "DeployDataBricksWorkBookPackage"
      }
    }
  ],
  "Parameters": [
    {
      "Id": "b8cd5d73-29d9-4ba2-bdfa-86cc1316a16f",
      "Name": "DeployDataBricksWorkBookPackage",
      "Label": "DataBricks WorkBook Package",
      "HelpText": "The Databricks workbook package",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "Package"
      }
    },
    {
      "Id": "f81b9ccb-beea-4d8f-a049-ee9ea6da643e",
      "Name": "DataBricksInstanceUri",
      "Label": "Databricks Instance Uri",
      "HelpText": "The Databricks Instance URL",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "6c1aed25-f9a6-4c1f-b8e9-d50cc8669f2d",
      "Name": "DataBricksAccessToken",
      "Label": "Databricks Access Token",
      "HelpText": "The access token to authenticate against the Databricks instance",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "Sensitive"
      }
    },
    {
      "Id": "c95af088-180b-419e-8c44-ce3fb4d96f57",
      "Name": "DatabricksImportFolder",
      "Label": "Databricks Workbook Import Folder",
      "HelpText": "Databricks Workbook import folder location",
      "DefaultValue": "/",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptSource": "Inline",
    "Octopus.Action.Script.Syntax": "PowerShell",
    "Octopus.Action.Script.ScriptBody": "$ErrorActionPreference = \"Stop\" #region fucntions\nfunction Set-DatabricksWorkBook\n{\n    [CmdletBinding()]\n    param (\n        [Parameter()]\n        [String]\n        $AccessToken, \n        [Parameter()]\n        [String]\n        $DataBricksInstanceUri,\n        [Parameter()]\n        [String]\n        $WorkbooksUploadPath,\n        [Parameter()]\n        [String]\n        $DatabrickImportFolder\n    )\n\n    $headers = @{\n        'Authorization' = (\"Bearer {0}\" -f $AccessToken )\n    }\n    $APIVersion = '/api/2.0'\n    $APICommand = '/workspace/import'\n    $Uri = \"https://$DataBricksInstanceUri$APIVersion$APICommand\"\n        \n    Get-ChildItem -Path $WorkbooksUploadPath -Recurse -File | ForEach-Object{ $currentWorkBook = $_\n        Write-Host (\"Importing Workbook:{0}\" -f $currentWorkBook.FullName)\n \t\t$workbookContent =  [Convert]::ToBase64String((Get-Content -path $currentWorkBook.FullName -Encoding byte))\n    \n        if($DatabrickImportFolder.EndsWith(\"/\"))\n    \t{\n    \t\t$workbookPath   = \"{0}{1}\" -f $DatabrickImportFolder , $currentWorkBook.BaseName\n    \t}\n    \telse \n    \t{\n        \t$workbookPath   = \"{0}/{1}\" -f $DatabrickImportFolder , $currentWorkBook.BaseName\n    \t}\n        \n        switch ($currentWorkBook.Extension.ToLower()) \n        {\n            '.ipynb' { \n                $workbookLanguage = \"PYTHON\" \n                $workbookFormat   = \"JUPYTER\"\n                break\n            }\n            '.scala' {\n                $workbookLanguage = \"SCALA\"\n                $workbookFormat   = \"SOURCE\"\n                break\n        }\n        Default \n            {\n                $workbookLanguage = \"SQL\"\n                $workbookFormat   = \"SOURCE\"\n            }\n        }\n        $requestBody = ConvertTo-Json -InputObject @{ \n            content = $workbookContent\n            path = $workbookPath\n            language = $workbookLanguage\n            format = $workbookFormat\n            overwrite = $true\n            }\n        \n        $apiResponse = Invoke-RestMethod -Method Post  -Uri  $Uri -Headers $headers -Body $requestBody\n        return $apiResponse\n    }\n}\n\n\nfunction Set-DatabricksWorkspaceFolder\n{\n    [CmdletBinding()]\n    param (\n        [Parameter()]\n        [String]\n        $AccessToken, \n        [Parameter()]\n        [String]\n        $DataBricksInstanceUri,\n        [Parameter()]\n        [String]\n        $DatabrickFolder\n    )\n\n    $headers = @{\n        'Authorization' = (\"Bearer {0}\" -f $AccessToken )\n    }\n    $APIVersion = '/api/2.0'\n    $APIListCommand = '/workspace/list'\n    $APIMkdirsCommand = '/workspace/mkdirs'\n    $ListUri = \"https://$DataBricksInstanceUri$APIVersion$APIListCommand\"\n    $MkdirsUri = \"https://$DataBricksInstanceUri$APIVersion$APIMkdirsCommand\"\n\n    $pathRoute = $DatabrickFolder.Substring(1) -split '/'\n    $basePath = \"/\"\n    foreach($path in $pathRoute)\n    {\n        $requestBody = @{ \n            path = $basePath\n        }\n        $apiResponse = Invoke-RestMethod -Uri $ListUri -Headers $headers -Body $requestBody -ContentType application/json  \n        $workSpaceFolder = $apiResponse.objects | Where-Object {$_.object_type -eq \"DIRECTORY\" -and $_.path -eq ( \"{0}{1}\" -f $basePath , $path) } \n        if($null -eq $workSpaceFolder)\n        {\n            $requestBody = ConvertTo-Json -InputObject  @{ \n                path = ( \"{0}{1}\" -f $basePath , $path)\n            } \n            Invoke-RestMethod -Method Post -Uri $MkdirsUri -Headers $headers -Body $requestBody\n        }\n        $basePath = \"{0}/{1}/\" -f $basePath , $path\n        if($basePath.StartsWith(\"//\"))\n        {\n            $basePath = $basePath.Substring(1)\n        }\n    }\n}\n\n#endregion fucntions\n\n\n$DatabrickWorkBookImportFolder = $OctopusParameters[\"Octopus.Action.Package[DeployDataBricksWorkBookPackage].ExtractedPath\"]\n\nWrite-Host \"Checking WorkSpace Folders\"\nSet-DatabricksWorkspaceFolder  -AccessToken $DataBricksAccessToken -DataBricksInstanceUri $DataBricksInstanceUri -DatabrickFolder $DatabricksImportFolder\nWrite-Host \"Importing Databricks Workbooks\"\nSet-DatabricksWorkBook -AccessToken $DataBricksAccessToken -DataBricksInstanceUri $DataBricksInstanceUri -WorkbooksUploadPath $DatabrickWorkBookImportFolder -DatabrickImportFolder $DatabricksImportFolder\n"
  },
  "Category": "Databricks",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/import-databricks-workbooks.json",
  "Website": "/step-templates/0bbe289c-3ea9-47f8-970c-caa946878f49",
  "Logo": "https://i.octopus.com/library/step-templates/databricks.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/import-databricks-workbooks.json)

</div>
