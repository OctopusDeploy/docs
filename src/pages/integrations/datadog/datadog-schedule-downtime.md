---
layout: src/layouts/Default.astro
pubDate: 2016-03-01
title: 'Datadog - Schedule Downtime'
description: 'Datadog is cloud monitoring service which allows you to push arbitrary events into via an api. This task allows you to schedule a downtime event to prevent error alerts during a deployment.'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2016-03-01 by baynewc1 belongs to 'Datadog' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Datadog Api Key

`ApiKey`

The api key used to authenticate with Datadog

</div>
        
<div class="param">

### Datadog Application Key

`AppKey`

The Application key used to authenticate with Datadog

</div>
        
<div class="param">

### Datadog Endpoint

`DatadogEndpoint = https://app.datadoghq.com`

The endpoint for datadog, for most (if not all) instances this should just be "https://app.datadoghq.com"

</div>
        
<div class="param">

### Environment

`Environment`

Environment tag in Datadog to schedule the downtime for

</div>
        
<div class="param">

### Downtime Duration (seconds)

`Duration = 600`

How long should the downtime be scheduled for, in seconds default is 10 minutes

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```powershell
# Lets handle our own errors here
$ErrorActionPreference = "continue"

$apiKey = $OctopusParameters['ApiKey']
$appKey = $OctopusParameters['AppKey']
$endpoint = $OctopusParameters['DatadogEndpoint']
$downtimeApiEndpoint = "/api/v1/downtime"
$scope = $OctopusParameters['Environment']
$durstring = $OctopusParameters['Duration']

[int]$duration = [convert]::ToInt32($durstring,10)

# Write out some debug information
Write-Host "Scheduling Downtime for: $scope"
Write-Host "Datadog Endpoint: $endpoint$downtimeApiEndpoint"

# Create the url from basic information
$url = "$endpoint$downtimeApiEndpoint`?api_key=$apiKey&application_key=$appKey"

Write-Host $url

$start=[Math]::Floor([decimal](Get-Date(Get-Date).ToUniversalTime()-uformat "%s"))
$end = $start + $duration
$json = @"
{
      "scope": "env:$scope",
      "start": "$start",
      "end": "$end"
  }
"@

# Make the response and handle exceptions **Requires PS 3.0 + 
try {
    $response = Invoke-WebRequest -Uri $url -Method POST -Body ($json | ConvertFrom-Json | ConvertTo-Json) -ContentType "Application/json" -UseBasicParsing
}catch{
    Write-Error "Error: $_"
    EXIT 0
}

# Some Error handling here
if($response.StatusCode -ne 200){
    Write-Error "There was an error listing response content below to debug"
    $response.RawContent
}else{
    Write-Host "Sent Successfully"
}

# We usually don't want to fail a deployment because of this
EXIT 0
```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20Datadog%20-%20Schedule%20Downtime&step-template=Datadog%20-%20Schedule%20Downtime)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "4db094ce-9c74-499d-8129-ce973cdaa9d4",
  "Name": "Datadog - Schedule Downtime",
  "Description": "Datadog is cloud monitoring service which allows you to push arbitrary events into via an api. This task allows you to schedule a downtime event to prevent error alerts during a deployment.",
  "Version": 4,
  "ExportedAt": "2016-03-01T23:11:19.809Z",
  "ActionType": "Octopus.Script",
  "Author": "baynewc1",
  "Parameters": [
    {
      "Name": "ApiKey",
      "Label": "Datadog Api Key",
      "HelpText": "The api key used to authenticate with Datadog",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "AppKey",
      "Label": "Datadog Application Key",
      "HelpText": "The Application key used to authenticate with Datadog",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "DatadogEndpoint",
      "Label": "Datadog Endpoint",
      "HelpText": "The endpoint for datadog, for most (if not all) instances this should just be \"https://app.datadoghq.com\"",
      "DefaultValue": "https://app.datadoghq.com",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "Environment",
      "Label": "Environment",
      "HelpText": "Environment tag in Datadog to schedule the downtime for",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "Duration",
      "Label": "Downtime Duration (seconds)",
      "HelpText": "How long should the downtime be scheduled for, in seconds default is 10 minutes",
      "DefaultValue": "600",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.Syntax": "PowerShell",
    "Octopus.Action.Script.ScriptBody": "# Lets handle our own errors here\n$ErrorActionPreference = \"continue\"\n\n$apiKey = $OctopusParameters['ApiKey']\n$appKey = $OctopusParameters['AppKey']\n$endpoint = $OctopusParameters['DatadogEndpoint']\n$downtimeApiEndpoint = \"/api/v1/downtime\"\n$scope = $OctopusParameters['Environment']\n$durstring = $OctopusParameters['Duration']\n\n[int]$duration = [convert]::ToInt32($durstring,10)\n\n# Write out some debug information\nWrite-Host \"Scheduling Downtime for: $scope\"\nWrite-Host \"Datadog Endpoint: $endpoint$downtimeApiEndpoint\"\n\n# Create the url from basic information\n$url = \"$endpoint$downtimeApiEndpoint`?api_key=$apiKey&application_key=$appKey\"\n\nWrite-Host $url\n\n$start=[Math]::Floor([decimal](Get-Date(Get-Date).ToUniversalTime()-uformat \"%s\"))\n$end = $start + $duration\n$json = @\"\n{\n      \"scope\": \"env:$scope\",\n      \"start\": \"$start\",\n      \"end\": \"$end\"\n  }\n\"@\n\n# Make the response and handle exceptions **Requires PS 3.0 + \ntry {\n    $response = Invoke-WebRequest -Uri $url -Method POST -Body ($json | ConvertFrom-Json | ConvertTo-Json) -ContentType \"Application/json\" -UseBasicParsing\n}catch{\n    Write-Error \"Error: $_\"\n    EXIT 0\n}\n\n# Some Error handling here\nif($response.StatusCode -ne 200){\n    Write-Error \"There was an error listing response content below to debug\"\n    $response.RawContent\n}else{\n    Write-Host \"Sent Successfully\"\n}\n\n# We usually don't want to fail a deployment because of this\nEXIT 0"
  },
  "Category": "Datadog",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/datadog-schedule-downtime.json",
  "Website": "/step-templates/4db094ce-9c74-499d-8129-ce973cdaa9d4",
  "Logo": "https://i.octopus.com/library/step-templates/datadog.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/datadog-schedule-downtime.json)

</div>
