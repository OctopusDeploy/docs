---
layout: src/layouts/Default.astro
pubDate: 2018-02-22
title: 'Uninstall TopShelf service'
description: 'This step can be used before unpacking a package with your TopShelf service to stop and remove the previous installation, if there is one.'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2018-02-22 by sphinxy belongs to 'Topshelf' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### 

`Unpackage step = `

The step where you unpack the topshelf service

</div>
        
<div class="param">

### 

`Exe filename = `

Name of exe file for service, if empty, package Id+".exe." will be used as default

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```powershell
$step = $OctopusParameters['Unpackage step']
$previous = $OctopusParameters["Octopus.Action[$step].Package.CustomInstallationDirectory"]
$customExeFilename = $OctopusParameters['Exe filename'];

if(!$previous -or (-not (Test-Path $previous)) )
{
    Write-Host "No installation found in: $previous"
	
    $previous = $OctopusParameters["Octopus.Action[$step].Output.Package.InstallationDirectoryPath"]
    if(!$previous -or (-not (Test-Path $previous)) )
    {
        Write-Host "No installation found in: $previous"
        Break
    }
}


$defaultExeFilename = $OctopusParameters["Octopus.Action[$step].Package.NuGetPackageId"] + ".exe"
$exeFilename = If ($customExeFilename) {$customExeFilename} Else {$defaultExeFilename}
$path = Join-Path $previous $exeFilename

Write-Host "Previous installation: $path"

Start-Process $path -ArgumentList "stop" -NoNewWindow -Wait | Write-Host
Start-Process $path -ArgumentList "uninstall" -NoNewWindow -Wait | Write-Host

```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20Uninstall%20TopShelf%20service&step-template=Uninstall%20TopShelf%20service)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "b5a4ed5a-7fb3-4d0c-b4a5-02616d0ed919",
  "Name": "Uninstall TopShelf service",
  "Description": "This step can be used before unpacking a package with your TopShelf service to stop and remove the previous installation, if there is one.",
  "Version": 4,
  "ExportedAt": "2018-02-22T16:57:20.068Z",
  "ActionType": "Octopus.Script",
  "Author": "sphinxy",
  "Parameters": [
    {
      "Id": "14d4b5e5-98ff-48ee-aeba-c062e294a18c",
      "Name": "Unpackage step",
      "Label": "",
      "HelpText": "The step where you unpack the topshelf service",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "StepName"
      },
      "Links": {}
    },
    {
      "Id": "75418f4b-48fb-4475-93a1-a6d793495693",
      "Name": "Exe filename",
      "Label": "",
      "HelpText": "Name of exe file for service, if empty, package Id+\".exe.\" will be used as default",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      },
      "Links": {}
    }
  ],
  "Properties": {
    "Octopus.Action.Script.Syntax": "PowerShell",
    "Octopus.Action.Script.ScriptSource": "Inline",
    "Octopus.Action.RunOnServer": "false",
    "Octopus.Action.Script.ScriptBody": "$step = $OctopusParameters['Unpackage step']\n$previous = $OctopusParameters[\"Octopus.Action[$step].Package.CustomInstallationDirectory\"]\n$customExeFilename = $OctopusParameters['Exe filename'];\n\nif(!$previous -or (-not (Test-Path $previous)) )\n{\n    Write-Host \"No installation found in: $previous\"\n\t\n    $previous = $OctopusParameters[\"Octopus.Action[$step].Output.Package.InstallationDirectoryPath\"]\n    if(!$previous -or (-not (Test-Path $previous)) )\n    {\n        Write-Host \"No installation found in: $previous\"\n        Break\n    }\n}\n\n\n$defaultExeFilename = $OctopusParameters[\"Octopus.Action[$step].Package.NuGetPackageId\"] + \".exe\"\n$exeFilename = If ($customExeFilename) {$customExeFilename} Else {$defaultExeFilename}\n$path = Join-Path $previous $exeFilename\n\nWrite-Host \"Previous installation: $path\"\n\nStart-Process $path -ArgumentList \"stop\" -NoNewWindow -Wait | Write-Host\nStart-Process $path -ArgumentList \"uninstall\" -NoNewWindow -Wait | Write-Host\n"
  },
  "Category": "Topshelf",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/topshelf-uninstall.json",
  "Website": "/step-templates/b5a4ed5a-7fb3-4d0c-b4a5-02616d0ed919",
  "Logo": "https://i.octopus.com/library/step-templates/topshelf.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/topshelf-uninstall.json)

</div>
