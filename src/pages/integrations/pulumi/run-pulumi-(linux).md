---
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
layout: src/layouts/Default.astro
pubDate: 2019-09-26
title: 'Run Pulumi (Linux)'
description: 'Allows you to run Pulumi commands using the Pulumi CLI. For Pulumi stacks that deploy AWS resources, make sure your Octopus Project contains a variable called `AWS` of type `AWS Account`. For Pulumi stacks that deploy Azure resources, set the variable `Azure` of type `Azure Subscriptions` (Service Principal).

Learn more about adding an [AWS Account](https://octopus.com/docs/infrastructure/deployment-targets/aws#create-an-aws-account) or [Azure Subscriptions](https://octopus.com/docs/infrastructure/deployment-targets/azure#azure-service-principal) to your Octopus Deploy instance.'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
---

Octopus.Script exported 2019-09-26 by praneetloke belongs to 'Pulumi' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Stack Name

`Pulumi.StackName = `

The fully-qualified stack name against which the Pulumi commands will be run. Hint: `{orgName}/{projectName}/{stackName}`

</div>
        
<div class="param">

### Create Stack

`Pulumi.CreateStack = false`

Whether to create a new stack if it does not exist already.

</div>
        
<div class="param">

### Command

`Pulumi.Command = `

Eg. `preview`, `up`, `destroy` etc. Learn more [here](https://www.pulumi.com/docs/reference/cli/).

</div>
        
<div class="param">

### Command Args

`Pulumi.Args = `

Arguments to pass to the Pulumi command. Eg. `-v` to set the verbosity or `--logtostderr` to log to the standard error. [Learn more](https://www.pulumi.com/docs/reference/cli/) about the available commands and the arguments you can pass to each of them.

</div>
        
<div class="param">

### Pulumi Access Token

`Pulumi.AccessToken = `

The [Pulumi access token](https://www.pulumi.com/docs/intro/console/accounts-and-organizations/accounts/#access-tokens) to use. The access token must have access to the stack, which you are deploying. [Click here](https://app.pulumi.com/account/tokens) to go to the Access Tokens page on the Pulumi Console now.

</div>
        
<div class="param">

### Pulumi Working Directory

`Pulumi.WorkingDirectory = `

The working directory where the Pulumi app is extracted to.

</div>
        
<div class="param">

### Restore Dependencies

`Pulumi.Restore = true`

Whether to restore NodeJS dependencies.

</div>
        

## Script body

Steps based on this template will execute the following *Bash* script.

```bash
# Check if the pulumi command is in the path and if not, download and install it.
# Additionally, add pulumi to the path.
if ! [ -x "$(command -v pulumi)" ]; then
	curl -fsSL https://get.pulumi.com | sh
    export PATH=$PATH:$HOME/.pulumi/bin
	echo "Pulumi version: $(pulumi version)"
fi

accessToken=$(get_octopusvariable "Pulumi.AccessToken")
if [ -z "${accessToken:-}" ]; then
	fail_step "Pulumi Access Token must be specified."
fi
export PULUMI_ACCESS_TOKEN=$accessToken

# Check for AWS access key credentials and set those in the env.
export AWS_ACCESS_KEY_ID=$(get_octopusvariable "AWS.AccessKey")
export AWS_SECRET_ACCESS_KEY=$(get_octopusvariable "AWS.SecretKey")

# Check for Azure SP/personal account credentials and set those in the env.
export ARM_SUBSCRIPTION_ID=$(get_octopusvariable "Azure.SubscriptionNumber")
export ARM_TENANT_ID=$(get_octopusvariable "Azure.TenantId")
export ARM_CLIENT_ID=$(get_octopusvariable "Azure.Client")
export ARM_CLIENT_SECRET=$(get_octopusvariable "Azure.Password")

if [ -z "${AWS_SECRET_ACCESS_KEY:-}" ]; then
	if [ -z "${ARM_CLIENT_SECRET:-}" ]; then
    	fail_step "Neither secrets for AWS or Azure were detected."
    fi
fi

pulumi login

cwd=$(get_octopusvariable "Pulumi.WorkingDirectory")
if [ -n "${cwd:-}" ]; then
	pushd $cwd
fi

restoreDeps=$(get_octopusvariable "Pulumi.Restore")
if [ "$restoreDeps" = "True" ]; then
	echo "Restoring dependencies..."
	npm install
fi

createStackIfNotExists=$(get_octopusvariable "Pulumi.CreateStack")
stackName=$(get_octopusvariable "Pulumi.StackName")
echo "Selecting stack $stackName"
pulumi stack select $stackName || (
	if [ "$createStackIfNotExists" = "True" ]; then
    	pulumi stack init $stackName
    fi
)

pulCmd=$(get_octopusvariable "Pulumi.Command")
pulArgs=$(get_octopusvariable "Pulumi.Args")
if [ -n "${pulArgs:-}" ]; then
	pulumi $pulCmd $pulArgs
else
	pulumi $pulCmd
fi

# If a working directory was specified, we would have `pushd`, so let's `popd` now.
if [ -n "${cwd:-}" ]; then
	popd
fi

```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20Run%20Pulumi%20(Linux)&step-template=Run%20Pulumi%20(Linux))

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "76296cd1-7d8c-47e8-b33f-027ecd3ff6b5",
  "Name": "Run Pulumi (Linux)",
  "Description": "Allows you to run Pulumi commands using the Pulumi CLI. For Pulumi stacks that deploy AWS resources, make sure your Octopus Project contains a variable called `AWS` of type `AWS Account`. For Pulumi stacks that deploy Azure resources, set the variable `Azure` of type `Azure Subscriptions` (Service Principal).\n\nLearn more about adding an [AWS Account](https://octopus.com/docs/infrastructure/deployment-targets/aws#create-an-aws-account) or [Azure Subscriptions](https://octopus.com/docs/infrastructure/deployment-targets/azure#azure-service-principal) to your Octopus Deploy instance.",
  "Version": 3,
  "ExportedAt": "2019-09-26T01:21:54.376Z",
  "ActionType": "Octopus.Script",
  "Author": "praneetloke",
  "Packages": [],
  "Parameters": [
    {
      "Id": "94a93122-235e-4edd-8217-adbe63db85f1",
      "Name": "Pulumi.StackName",
      "Label": "Stack Name",
      "HelpText": "The fully-qualified stack name against which the Pulumi commands will be run. Hint: `{orgName}/{projectName}/{stackName}`",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "f00ffc37-a550-458e-85ff-43909eb76c79",
      "Name": "Pulumi.CreateStack",
      "Label": "Create Stack",
      "HelpText": "Whether to create a new stack if it does not exist already.",
      "DefaultValue": "false",
      "DisplaySettings": {
        "Octopus.ControlType": "Checkbox"
      }
    },
    {
      "Id": "29e68d5d-5c46-4290-993c-51672a431812",
      "Name": "Pulumi.Command",
      "Label": "Command",
      "HelpText": "Eg. `preview`, `up`, `destroy` etc. Learn more [here](https://www.pulumi.com/docs/reference/cli/).",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "362423a8-aab4-451f-b79b-3896725b8c84",
      "Name": "Pulumi.Args",
      "Label": "Command Args",
      "HelpText": "Arguments to pass to the Pulumi command. Eg. `-v` to set the verbosity or `--logtostderr` to log to the standard error. [Learn more](https://www.pulumi.com/docs/reference/cli/) about the available commands and the arguments you can pass to each of them.",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "9f6bda9f-39dd-47cf-9233-5499a837c4fb",
      "Name": "Pulumi.AccessToken",
      "Label": "Pulumi Access Token",
      "HelpText": "The [Pulumi access token](https://www.pulumi.com/docs/intro/console/accounts-and-organizations/accounts/#access-tokens) to use. The access token must have access to the stack, which you are deploying. [Click here](https://app.pulumi.com/account/tokens) to go to the Access Tokens page on the Pulumi Console now.",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "Sensitive"
      }
    },
    {
      "Id": "aa4310d6-52eb-4b37-9575-db6cfe7c3e3a",
      "Name": "Pulumi.WorkingDirectory",
      "Label": "Pulumi Working Directory",
      "HelpText": "The working directory where the Pulumi app is extracted to.",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "d4d357c7-d4a9-4c1c-b38e-6efcb363ce0b",
      "Name": "Pulumi.Restore",
      "Label": "Restore Dependencies",
      "HelpText": "Whether to restore NodeJS dependencies.",
      "DefaultValue": "true",
      "DisplaySettings": {
        "Octopus.ControlType": "Checkbox"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptSource": "Inline",
    "Octopus.Action.Script.Syntax": "Bash",
    "Octopus.Action.Script.ScriptBody": "# Check if the pulumi command is in the path and if not, download and install it.\n# Additionally, add pulumi to the path.\nif ! [ -x \"$(command -v pulumi)\" ]; then\n\tcurl -fsSL https://get.pulumi.com | sh\n    export PATH=$PATH:$HOME/.pulumi/bin\n\techo \"Pulumi version: $(pulumi version)\"\nfi\n\naccessToken=$(get_octopusvariable \"Pulumi.AccessToken\")\nif [ -z \"${accessToken:-}\" ]; then\n\tfail_step \"Pulumi Access Token must be specified.\"\nfi\nexport PULUMI_ACCESS_TOKEN=$accessToken\n\n# Check for AWS access key credentials and set those in the env.\nexport AWS_ACCESS_KEY_ID=$(get_octopusvariable \"AWS.AccessKey\")\nexport AWS_SECRET_ACCESS_KEY=$(get_octopusvariable \"AWS.SecretKey\")\n\n# Check for Azure SP/personal account credentials and set those in the env.\nexport ARM_SUBSCRIPTION_ID=$(get_octopusvariable \"Azure.SubscriptionNumber\")\nexport ARM_TENANT_ID=$(get_octopusvariable \"Azure.TenantId\")\nexport ARM_CLIENT_ID=$(get_octopusvariable \"Azure.Client\")\nexport ARM_CLIENT_SECRET=$(get_octopusvariable \"Azure.Password\")\n\nif [ -z \"${AWS_SECRET_ACCESS_KEY:-}\" ]; then\n\tif [ -z \"${ARM_CLIENT_SECRET:-}\" ]; then\n    \tfail_step \"Neither secrets for AWS or Azure were detected.\"\n    fi\nfi\n\npulumi login\n\ncwd=$(get_octopusvariable \"Pulumi.WorkingDirectory\")\nif [ -n \"${cwd:-}\" ]; then\n\tpushd $cwd\nfi\n\nrestoreDeps=$(get_octopusvariable \"Pulumi.Restore\")\nif [ \"$restoreDeps\" = \"True\" ]; then\n\techo \"Restoring dependencies...\"\n\tnpm install\nfi\n\ncreateStackIfNotExists=$(get_octopusvariable \"Pulumi.CreateStack\")\nstackName=$(get_octopusvariable \"Pulumi.StackName\")\necho \"Selecting stack $stackName\"\npulumi stack select $stackName || (\n\tif [ \"$createStackIfNotExists\" = \"True\" ]; then\n    \tpulumi stack init $stackName\n    fi\n)\n\npulCmd=$(get_octopusvariable \"Pulumi.Command\")\npulArgs=$(get_octopusvariable \"Pulumi.Args\")\nif [ -n \"${pulArgs:-}\" ]; then\n\tpulumi $pulCmd $pulArgs\nelse\n\tpulumi $pulCmd\nfi\n\n# If a working directory was specified, we would have `pushd`, so let's `popd` now.\nif [ -n \"${cwd:-}\" ]; then\n\tpopd\nfi\n"
  },
  "Category": "Pulumi",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/run-pulumi-on-linux.json",
  "Website": "/step-templates/76296cd1-7d8c-47e8-b33f-027ecd3ff6b5",
  "Logo": "https://i.octopus.com/library/step-templates/pulumi.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/run-pulumi-on-linux.json)

</div>
