---
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
layout: src/layouts/Default.astro
pubDate: 2017-06-28
title: 'IIS - Enable or Disable Authentication Methods'
description: 'Step template to set the desired IIS Authentication (Anonymous, Windows, Digest) State for IIS site(s)'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
---

Octopus.Script exported 2017-06-28 by HumanPrinter belongs to 'IIS' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Anonymous Authentication

`AnonymousAuth = False`

Enable Anonymous Authentication.

</div>
        
<div class="param">

### Windows Authentication

`WindowsAuth = False`

Enable Windows Authentication.

</div>
        
<div class="param">

### Digest Authentication

`DigestAuth = False`

Enable Digest Authentication.

</div>
        
<div class="param">

### IIS Site name(s)

`IISSitePaths`

The IIS site(s) which will have security permissions transformed. Multiple values are to be new-line separated.

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```powershell
#requires -version 3

function Update-IISSiteAuthentication {
    param
    (
        [ValidateNotNullOrEmpty()]
        [Parameter(Mandatory = $true)]
        [boolean]$State,
        [ValidateNotNullOrEmpty()]
        [Parameter(Mandatory = $true)]
        [string]$SitePath,
        [ValidateNotNullOrEmpty()]
        [Parameter(Mandatory = $true)]
        [string]$AuthMethod
    )
    
    # check if WebAdministration module exists on the server
    $cmd = (Get-Command "Get-Website" -errorAction SilentlyContinue)
    if ($null -eq $cmd) {
        throw "The Windows PowerShell snap-in 'WebAdministration' is not installed on this server. Details can be found at https://technet.microsoft.com/en-us/library/ee790599.aspx."
    }
    
    $IISSecurityPath = "/system.WebServer/security/authentication/$AuthMethod"
    $separator = "`r","`n",","
    $IISSites = $sitepath.split($separator, [System.StringSplitOptions]::RemoveEmptyEntries).Trim(' ')

    $IISValidSites = New-Object System.Collections.ArrayList
	foreach ($website in Get-Website) {
        $IISValidSites.Add($website.name)
        foreach ($app in Get-WebApplication -Site $website.name) {
			$path = $website.name + $app.path
			$IISValidSites.Add($path)
		}
	}

    $IISValidSiteNames = $IISValidSites -join ', '

    foreach($Site in $IISSites) {
        $IISSiteAvailable = $IISValidSites | Where-Object { $_ -eq $Site }

        if ($IISSiteAvailable) {
            Set-WebConfigurationProperty -Filter $IISSecurityPath -Name Enabled -Value $State -PSPath IIS:\\ -Location $Site
            Write-Output "$AuthMethod for site '$Site' set successfully to '$State'."
        }
        else {
            Write-Output "The IISSitePath '$Site' cannot be found. The valid sites are $IISValidSiteNames"
            throw "The IISSitePath '$Site' cannot be found. The valid sites are $IISValidSiteNames"
        }
    }
}

if (Test-Path Variable:OctopusParameters) {
    Update-IISSiteAuthentication -State ($AnonymousAuth -eq "True") -SitePath $IISSitePaths -AuthMethod "AnonymousAuthentication"
    Update-IISSiteAuthentication -State ($WindowsAuth -eq "True") -SitePath $IISSitePaths -AuthMethod "WindowsAuthentication"
    Update-IISSiteAuthentication -State ($DigestAuth -eq "True") -SitePath $IISSitePaths -AuthMethod "DigestAuthentication"
}
```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20IIS%20-%20Enable%20or%20Disable%20Authentication%20Methods&step-template=IIS%20-%20Enable%20or%20Disable%20Authentication%20Methods)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "d3aa2e7b-d716-4f66-8d85-068cacedbb4f",
  "Name": "IIS - Enable or Disable Authentication Methods",
  "Description": "Step template to set the desired IIS Authentication (Anonymous, Windows, Digest) State for IIS site(s)",
  "Version": 4,
  "ExportedAt": "2017-06-28T11:48:00+00:00",
  "ActionType": "Octopus.Script",
  "Author": "HumanPrinter",
  "Parameters": [
    {
      "Name": "AnonymousAuth",
      "Label": "Anonymous Authentication",
      "HelpText": "Enable Anonymous Authentication.",
      "DefaultValue": "False",
      "DisplaySettings": {
        "Octopus.ControlType": "Checkbox"
      }
    },
    {
      "Name": "WindowsAuth",
      "Label": "Windows Authentication",
      "HelpText": "Enable Windows Authentication.",
      "DefaultValue": "False",
      "DisplaySettings": {
        "Octopus.ControlType": "Checkbox"
      }
    },
    {
      "Name": "DigestAuth",
      "Label": "Digest Authentication",
      "HelpText": "Enable Digest Authentication.",
      "DefaultValue": "False",
      "DisplaySettings": {
        "Octopus.ControlType": "Checkbox"
      }
    },
    {
      "Name": "IISSitePaths",
      "Label": "IIS Site name(s)",
      "HelpText": "The IIS site(s) which will have security permissions transformed. Multiple values are to be new-line separated.",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "MultiLineText"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptBody": "#requires -version 3\n\nfunction Update-IISSiteAuthentication {\n    param\n    (\n        [ValidateNotNullOrEmpty()]\n        [Parameter(Mandatory = $true)]\n        [boolean]$State,\n        [ValidateNotNullOrEmpty()]\n        [Parameter(Mandatory = $true)]\n        [string]$SitePath,\n        [ValidateNotNullOrEmpty()]\n        [Parameter(Mandatory = $true)]\n        [string]$AuthMethod\n    )\n    \n    # check if WebAdministration module exists on the server\n    $cmd = (Get-Command \"Get-Website\" -errorAction SilentlyContinue)\n    if ($null -eq $cmd) {\n        throw \"The Windows PowerShell snap-in 'WebAdministration' is not installed on this server. Details can be found at https://technet.microsoft.com/en-us/library/ee790599.aspx.\"\n    }\n    \n    $IISSecurityPath = \"/system.WebServer/security/authentication/$AuthMethod\"\n    $separator = \"`r\",\"`n\",\",\"\n    $IISSites = $sitepath.split($separator, [System.StringSplitOptions]::RemoveEmptyEntries).Trim(' ')\n\n    $IISValidSites = New-Object System.Collections.ArrayList\n\tforeach ($website in Get-Website) {\n        $IISValidSites.Add($website.name)\n        foreach ($app in Get-WebApplication -Site $website.name) {\n\t\t\t$path = $website.name + $app.path\n\t\t\t$IISValidSites.Add($path)\n\t\t}\n\t}\n\n    $IISValidSiteNames = $IISValidSites -join ', '\n\n    foreach($Site in $IISSites) {\n        $IISSiteAvailable = $IISValidSites | Where-Object { $_ -eq $Site }\n\n        if ($IISSiteAvailable) {\n            Set-WebConfigurationProperty -Filter $IISSecurityPath -Name Enabled -Value $State -PSPath IIS:\\\\ -Location $Site\n            Write-Output \"$AuthMethod for site '$Site' set successfully to '$State'.\"\n        }\n        else {\n            Write-Output \"The IISSitePath '$Site' cannot be found. The valid sites are $IISValidSiteNames\"\n            throw \"The IISSitePath '$Site' cannot be found. The valid sites are $IISValidSiteNames\"\n        }\n    }\n}\n\nif (Test-Path Variable:OctopusParameters) {\n    Update-IISSiteAuthentication -State ($AnonymousAuth -eq \"True\") -SitePath $IISSitePaths -AuthMethod \"AnonymousAuthentication\"\n    Update-IISSiteAuthentication -State ($WindowsAuth -eq \"True\") -SitePath $IISSitePaths -AuthMethod \"WindowsAuthentication\"\n    Update-IISSiteAuthentication -State ($DigestAuth -eq \"True\") -SitePath $IISSitePaths -AuthMethod \"DigestAuthentication\"\n}",
    "Octopus.Action.Script.Syntax": "PowerShell",
    "Octopus.Action.Script.ScriptSource": "Inline",
    "Octopus.Action.Script.ScriptFileName": null,
    "Octopus.Action.Package.NuGetFeedId": null,
    "Octopus.Action.Package.NuGetPackageId": null
  },
  "Category": "IIS",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/iis-set-authentication.steptemplate.json",
  "Website": "/step-templates/d3aa2e7b-d716-4f66-8d85-068cacedbb4f",
  "Logo": "https://i.octopus.com/library/step-templates/iis.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/iis-set-authentication.steptemplate.json)

</div>
