---
layout: src/layouts/Default.astro
pubDate: 2019-03-19
title: 'IIS Website - Add Release Number to Response Header'
description: 'Adds the Octopus Deploy Release number to the IIS response header. When you browse your site you can look at the response header to verify the build number that is running.'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2019-03-19 by geeeyetee belongs to 'IIS' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Field name

`headerFieldName = Release`

The name of the custom header field with the release information.

</div>
        
<div class="param">

### Website name

`headerWebsiteName`

The name of the website in IIS.

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```powershell
Write-Host "Adding release number to response header"

function Get-IISServerManager
{
    [CmdletBinding()]
    [OutputType([System.Object])]
    param ()

    $iisInstallPath = (Get-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\INetStp' -Name InstallPath).InstallPath
    if (-not $iisInstallPath)
    {
        throw ('IIS installation path not found')
    }
    $assyPath = Join-Path -Path $iisInstallPath -ChildPath 'Microsoft.Web.Administration.dll' -Resolve -ErrorAction:SilentlyContinue
    if (-not $assyPath)
    {
        throw 'IIS version of Microsoft.Web.Administration.dll not found'
    }
    $assy = [System.Reflection.Assembly]::LoadFrom($assyPath)
    return [System.Activator]::CreateInstance($assy.FullName, 'Microsoft.Web.Administration.ServerManager').Unwrap()
}

$iis = Get-IISServerManager
$config = $iis.GetWebConfiguration($OctopusParameters['headerWebsiteName'])
$httpProtocolSection = $config.GetSection("system.webServer/httpProtocol")
$customHeadersCollection = $httpProtocolSection.GetCollection("customHeaders")

$update = $true

foreach($path in $customHeadersCollection.GetCollection()) { 
    if ($path.GetAttributeValue("name") -eq $OctopusParameters['headerFieldName']) {
        write-host "Release number is already in the response header, skipping"
        $update = $false
        break
    }
}

if ($update)
{
    $fieldName = $OctopusParameters['headerFieldName']
    $releaseNumber = $OctopusParameters['Octopus.Release.Number']
    
    Write-Host "Adding release number $releaseNumber to custom header $fieldName"
    
    $addElement = $customHeadersCollection.CreateElement("add")
    $addElement["name"] = $fieldName
    $addElement["value"] = $releaseNumber
    $customHeadersCollection.Add($addElement)
    
    $iis.CommitChanges() | Write-Host
}
```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20IIS%20Website%20-%20Add%20Release%20Number%20to%20Response%20Header&step-template=IIS%20Website%20-%20Add%20Release%20Number%20to%20Response%20Header)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "7b51887e-1ad2-4133-b3a3-37688bb49b01",
  "Name": "IIS Website - Add Release Number to Response Header",
  "Description": "Adds the Octopus Deploy Release number to the IIS response header. When you browse your site you can look at the response header to verify the build number that is running.",
  "Version": 10,
  "ExportedAt": "2019-03-19T16:25:56.946Z",
  "ActionType": "Octopus.Script",
  "Author": "geeeyetee",
  "Parameters": [
    {
      "Name": "headerFieldName",
      "Label": "Field name",
      "HelpText": "The name of the custom header field with the release information.",
      "DefaultValue": "Release",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "headerWebsiteName",
      "Label": "Website name",
      "HelpText": "The name of the website in IIS.",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptBody": "Write-Host \"Adding release number to response header\"\n\nfunction Get-IISServerManager\n{\n    [CmdletBinding()]\n    [OutputType([System.Object])]\n    param ()\n\n    $iisInstallPath = (Get-ItemProperty -Path 'HKLM:\\SOFTWARE\\Microsoft\\INetStp' -Name InstallPath).InstallPath\n    if (-not $iisInstallPath)\n    {\n        throw ('IIS installation path not found')\n    }\n    $assyPath = Join-Path -Path $iisInstallPath -ChildPath 'Microsoft.Web.Administration.dll' -Resolve -ErrorAction:SilentlyContinue\n    if (-not $assyPath)\n    {\n        throw 'IIS version of Microsoft.Web.Administration.dll not found'\n    }\n    $assy = [System.Reflection.Assembly]::LoadFrom($assyPath)\n    return [System.Activator]::CreateInstance($assy.FullName, 'Microsoft.Web.Administration.ServerManager').Unwrap()\n}\n\n$iis = Get-IISServerManager\n$config = $iis.GetWebConfiguration($OctopusParameters['headerWebsiteName'])\n$httpProtocolSection = $config.GetSection(\"system.webServer/httpProtocol\")\n$customHeadersCollection = $httpProtocolSection.GetCollection(\"customHeaders\")\n\n$update = $true\n\nforeach($path in $customHeadersCollection.GetCollection()) { \n    if ($path.GetAttributeValue(\"name\") -eq $OctopusParameters['headerFieldName']) {\n        write-host \"Release number is already in the response header, skipping\"\n        $update = $false\n        break\n    }\n}\n\nif ($update)\n{\n    $fieldName = $OctopusParameters['headerFieldName']\n    $releaseNumber = $OctopusParameters['Octopus.Release.Number']\n    \n    Write-Host \"Adding release number $releaseNumber to custom header $fieldName\"\n    \n    $addElement = $customHeadersCollection.CreateElement(\"add\")\n    $addElement[\"name\"] = $fieldName\n    $addElement[\"value\"] = $releaseNumber\n    $customHeadersCollection.Add($addElement)\n    \n    $iis.CommitChanges() | Write-Host\n}",
    "Octopus.Action.Script.Syntax": "PowerShell"
  },
  "Category": "IIS",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/iis-website-add-release-number-to-response-header.json",
  "Website": "/step-templates/7b51887e-1ad2-4133-b3a3-37688bb49b01",
  "Logo": "https://i.octopus.com/library/step-templates/iis.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/iis-website-add-release-number-to-response-header.json)

</div>
