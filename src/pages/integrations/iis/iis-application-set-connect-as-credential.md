---
layout: src/layouts/Default.astro
pubDate: 2018-12-04
title: 'IIS Application - Set Connect As credential'
description: 'Sets the credential for the Connect As of an IIS application'
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2018-12-04 by twerthi belongs to 'IIS' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Site Name

`IISSiteName = `

Name of the IIS site.

</div>
        
<div class="param">

### Application Name

`IISApplicationName = `

Name of the application to set the credential on.

</div>
        
<div class="param">

### User name

`ApplicationUserName = `

Name of the credential to apply, leave blank to set to Pass-through authentication.

</div>
        
<div class="param">

### Password

`ApplicationUserPassword = `

Password of the credential to set.

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```PowerShell
# Import the WebAdministration module
Import-Module WebAdministration

# Get reference to the site
$iisSite = Get-IISSite | Where-Object {$_.Name -ieq $IISSiteName}

# Check to make sure the site was found
if ($null -eq $iisSite)
{
	# Throw an error
    throw "$IISSiteName was not found."
}

# Check to see if $IISApplicationName starts with a /
if ($IISApplicationName.StartsWith("/"))
{
	# Remove the beginning slash
    $IISApplicationName = $IISApplicationName.SubString(1)
}

# Get reference to the application
$application = $iisSite.Applications | Where-Object {$_.Path -ieq "/$IISApplicationName"}

# Check to see if the application was found
if ($null -eq $application)
{
	# Throw an error
    throw "$IISApplicationName was not found."
}

# retrieve existing values
$currentUserName = Get-WebConfigurationProperty "system.applicationHost/sites/site[@name='$($iisSite.Name)']/application[@path='$($application.Path)']/virtualDirectory[@path='/']" -name username
$currentPassword = Get-WebConfigurationProperty "system.applicationHost/sites/site[@name='$($iisSite.Name)']/application[@path='$($application.Path)']/virtualDirectory[@path='/']" -name password

# Check the value of $ApplicationUserName
if ([string]::IsNullOrEmpty($ApplicationUserName))
{
    # Ensure $ApplicationUserName is an empty string
    $ApplicationUserName = [string]::Empty
}

# Check the value of $ApplicationPassword
if ([string]::IsNullOrEmpty($ApplicationUserPassword) -or $ApplicationUserName.EndsWith('$')) # Usernames ending in $ are an indication that an MSA is being used
{
	# Ensure $ApplicationPassword is empty string
    $ApplicationPassword = [string]::Empty
}

# Compare username values
if ($ApplicationUserName -ne $currentUserName.Value)
{
	# Display message
    Write-Output "Updating username for $IISSiteName/$IISApplicationName to $ApplicationUserName Connect As property"
    
	# Update the property
    Set-WebConfigurationProperty "system.applicationHost/sites/site[@name='$($iisSite.Name)']/application[@path='$($application.Path)']/virtualDirectory[@path='/']" -name username -value "$ApplicationUserName"
}
else
{
	# Display message
    Write-Output "User already set to $ApplicationUserName for $IISSiteName/$IISApplicationName Connect As property"
}

# Compare password values
if ($ApplicationUserPassword -ne $currentPassword.Value)
{
    # Display message
    Write-Output "Updating password for $IISSiteName/$IISApplicationName Connect As property"
    
    # Set password property
	Set-WebConfigurationProperty "system.applicationHost/sites/site[@name='$($iisSite.Name)']/application[@path='$($application.Path)']/virtualDirectory[@path='/']" -name password -value "$ApplicationUserPassword"
}
else
{
	# Display message
    Write-Output "Password does not need updating for $IISSiteName/$IISApplicationName Connect As property"
}

```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20IIS%20Application%20-%20Set%20Connect%20As%20credential&step-template=IIS%20Application%20-%20Set%20Connect%20As%20credential)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "1a482cf6-95ae-442f-92a4-c1e79d5c8e4b",
  "Name": "IIS Application - Set Connect As credential",
  "Description": "Sets the credential for the Connect As of an IIS application",
  "Version": 1,
  "ExportedAt": "2018-12-04T20:21:52.123Z",
  "ActionType": "Octopus.Script",
  "Author": "twerthi",
  "Packages": [],
  "Parameters": [
    {
      "Id": "cca187a4-2e55-4b71-98e8-87bf47b9744d",
      "Name": "IISSiteName",
      "Label": "Site Name",
      "HelpText": "Name of the IIS site.",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "381050b6-975b-4a10-b79c-a6fee9383cf2",
      "Name": "IISApplicationName",
      "Label": "Application Name",
      "HelpText": "Name of the application to set the credential on.",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "8b9f0aff-93d7-4bc0-b375-b30179835e17",
      "Name": "ApplicationUserName",
      "Label": "User name",
      "HelpText": "Name of the credential to apply, leave blank to set to Pass-through authentication.",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "220c4021-727a-4f10-935b-101a3cc8a3bb",
      "Name": "ApplicationUserPassword",
      "Label": "Password",
      "HelpText": "Password of the credential to set.",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "Sensitive"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptSource": "Inline",
    "Octopus.Action.Script.Syntax": "PowerShell",
    "Octopus.Action.Script.ScriptBody": "# Import the WebAdministration module\nImport-Module WebAdministration\n\n# Get reference to the site\n$iisSite = Get-IISSite | Where-Object {$_.Name -ieq $IISSiteName}\n\n# Check to make sure the site was found\nif ($null -eq $iisSite)\n{\n\t# Throw an error\n    throw \"$IISSiteName was not found.\"\n}\n\n# Check to see if $IISApplicationName starts with a /\nif ($IISApplicationName.StartsWith(\"/\"))\n{\n\t# Remove the beginning slash\n    $IISApplicationName = $IISApplicationName.SubString(1)\n}\n\n# Get reference to the application\n$application = $iisSite.Applications | Where-Object {$_.Path -ieq \"/$IISApplicationName\"}\n\n# Check to see if the application was found\nif ($null -eq $application)\n{\n\t# Throw an error\n    throw \"$IISApplicationName was not found.\"\n}\n\n# retrieve existing values\n$currentUserName = Get-WebConfigurationProperty \"system.applicationHost/sites/site[@name='$($iisSite.Name)']/application[@path='$($application.Path)']/virtualDirectory[@path='/']\" -name username\n$currentPassword = Get-WebConfigurationProperty \"system.applicationHost/sites/site[@name='$($iisSite.Name)']/application[@path='$($application.Path)']/virtualDirectory[@path='/']\" -name password\n\n# Check the value of $ApplicationUserName\nif ([string]::IsNullOrEmpty($ApplicationUserName))\n{\n    # Ensure $ApplicationUserName is an empty string\n    $ApplicationUserName = [string]::Empty\n}\n\n# Check the value of $ApplicationPassword\nif ([string]::IsNullOrEmpty($ApplicationUserPassword) -or $ApplicationUserName.EndsWith('$')) # Usernames ending in $ are an indication that an MSA is being used\n{\n\t# Ensure $ApplicationPassword is empty string\n    $ApplicationPassword = [string]::Empty\n}\n\n# Compare username values\nif ($ApplicationUserName -ne $currentUserName.Value)\n{\n\t# Display message\n    Write-Output \"Updating username for $IISSiteName/$IISApplicationName to $ApplicationUserName Connect As property\"\n    \n\t# Update the property\n    Set-WebConfigurationProperty \"system.applicationHost/sites/site[@name='$($iisSite.Name)']/application[@path='$($application.Path)']/virtualDirectory[@path='/']\" -name username -value \"$ApplicationUserName\"\n}\nelse\n{\n\t# Display message\n    Write-Output \"User already set to $ApplicationUserName for $IISSiteName/$IISApplicationName Connect As property\"\n}\n\n# Compare password values\nif ($ApplicationUserPassword -ne $currentPassword.Value)\n{\n    # Display message\n    Write-Output \"Updating password for $IISSiteName/$IISApplicationName Connect As property\"\n    \n    # Set password property\n\tSet-WebConfigurationProperty \"system.applicationHost/sites/site[@name='$($iisSite.Name)']/application[@path='$($application.Path)']/virtualDirectory[@path='/']\" -name password -value \"$ApplicationUserPassword\"\n}\nelse\n{\n\t# Display message\n    Write-Output \"Password does not need updating for $IISSiteName/$IISApplicationName Connect As property\"\n}\n"
  },
  "Category": "IIS",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/iis-app-set-connect-as-credential.json",
  "Website": "/step-templates/1a482cf6-95ae-442f-92a4-c1e79d5c8e4b",
  "Logo": "https://i.octopus.com/library/step-templates/iis.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/iis-app-set-connect-as-credential.json)

</div>
