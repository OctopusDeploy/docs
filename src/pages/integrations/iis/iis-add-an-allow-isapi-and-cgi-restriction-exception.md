---
layout: src/layouts/Default.astro
pubDate: 2016-01-13
title: 'IIS - Add an Allow ISAPI And CGI Restriction Exception'
description: 'Adds an IIS Server Allow exception to the ISAPI/CGI Restrictions in IIS 7 and above.'
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
---

Octopus.Script exported 2016-01-13 by ekrapfl belongs to 'IIS' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### CGI/ISAPI Extension Path

`cgiIsapiExtensionPath`

The full path to the ISAPI/CGI extension to allow.

</div>
        
<div class="param">

### Description

`description`

A description for the ISAPI/CGI Restriction allowance exception.

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```PowerShell
Param
(
    [Parameter(Position = 0)]
    [ValidateNotNullOrEmpty()]
    [string] $cgiIsapiExtensionPath,
    [Parameter(Position = 1)]
    [string] $description = [string]::Empty
)

$ErrorActionPrefrence = "Stop"


function Get-Param($Name, [switch]$Required, $Default) 
{
    $result = $null

    if ($OctopusParameters -ne $null) 
    {
        $result = $OctopusParameters[$Name]
    }

    if ($result -eq $null) 
    {
        $variable = Get-Variable $Name -EA SilentlyContinue    
        if ($variable -ne $null) 
        {
            $result = $variable.Value
        }
    }

    if ($result -eq $null) 
    {
        if ($Required) 
        {
            throw "Missing parameter value $Name"
        } 
        else 
        {
            $result = $Default
        }
    }

    return $result
}

& {
    Param
    (
        [Parameter(Mandatory=$True, Position = 0)]
        [ValidateNotNullOrEmpty()]
        [string] $cgiIsapiExtensionPath,
        [Parameter(Position = 1)]
        [string] $description = [string]::Empty
    )

    Import-Module "WebAdministration"

    $cgiIsapiConfiguration = Get-WebConfiguration -Filter "/system.webServer/security/isapiCgiRestriction/add" -PSPath "IIS:\"

    $cgiIsapiExtensionFullPath = [System.Environment]::ExpandEnvironmentVariables($cgiIsapiExtensionPath)
    $cgiIsapiExtensionFullPath = Resolve-Path -Path $cgiIsapiExtensionFullPath

    $restrictionFound = $false
    $cgiIsapiConfiguration | ForEach-Object {
        $itemFullPath = [System.Environment]::ExpandEnvironmentVariables($_.path)
        $itemFullPath = Resolve-Path -Path $itemFullPath

        if ($itemFullPath.Path -eq $cgiIsapiExtensionFullPath.Path)
        {
           $restrictionFound = $true
        }
    }

    if ($restrictionFound -eq $false)
    {
        Add-WebConfiguration -PSPath 'MACHINE/WEBROOT/APPHOST' -Filter "system.webServer/security/isapiCgiRestriction" -value @{description="$description";path="$cgiIsapiExtensionPath";allowed='True'}
    }
    else
    {
        Write-Host "Allowed CGI/ISAPI Restriction for '$cgiIsapiExtensionPath' already exists."
    }
} `
(Get-Param 'cgiIsapiExtensionPath' -Required) `
(Get-Param 'description')
```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20IIS%20-%20Add%20an%20Allow%20ISAPI%20And%20CGI%20Restriction%20Exception&step-template=IIS%20-%20Add%20an%20Allow%20ISAPI%20And%20CGI%20Restriction%20Exception)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "47e1a39c-65f3-43aa-ad5e-ea1946bbf368",
  "Name": "IIS - Add an Allow ISAPI And CGI Restriction Exception",
  "Description": "Adds an IIS Server Allow exception to the ISAPI/CGI Restrictions in IIS 7 and above.",
  "Version": 4,
  "ExportedAt": "2016-01-13T21:28:56.040+00:00",
  "ActionType": "Octopus.Script",
  "Author": "ekrapfl",
  "Parameters": [
    {
      "Name": "cgiIsapiExtensionPath",
      "Label": "CGI/ISAPI Extension Path",
      "HelpText": "The full path to the ISAPI/CGI extension to allow.",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "description",
      "Label": "Description",
      "HelpText": "A description for the ISAPI/CGI Restriction allowance exception.",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptBody": "Param\n(\n    [Parameter(Position = 0)]\n    [ValidateNotNullOrEmpty()]\n    [string] $cgiIsapiExtensionPath,\n    [Parameter(Position = 1)]\n    [string] $description = [string]::Empty\n)\n\n$ErrorActionPrefrence = \"Stop\"\n\n\nfunction Get-Param($Name, [switch]$Required, $Default) \n{\n    $result = $null\n\n    if ($OctopusParameters -ne $null) \n    {\n        $result = $OctopusParameters[$Name]\n    }\n\n    if ($result -eq $null) \n    {\n        $variable = Get-Variable $Name -EA SilentlyContinue    \n        if ($variable -ne $null) \n        {\n            $result = $variable.Value\n        }\n    }\n\n    if ($result -eq $null) \n    {\n        if ($Required) \n        {\n            throw \"Missing parameter value $Name\"\n        } \n        else \n        {\n            $result = $Default\n        }\n    }\n\n    return $result\n}\n\n& {\n    Param\n    (\n        [Parameter(Mandatory=$True, Position = 0)]\n        [ValidateNotNullOrEmpty()]\n        [string] $cgiIsapiExtensionPath,\n        [Parameter(Position = 1)]\n        [string] $description = [string]::Empty\n    )\n\n    Import-Module \"WebAdministration\"\n\n    $cgiIsapiConfiguration = Get-WebConfiguration -Filter \"/system.webServer/security/isapiCgiRestriction/add\" -PSPath \"IIS:\\\"\n\n    $cgiIsapiExtensionFullPath = [System.Environment]::ExpandEnvironmentVariables($cgiIsapiExtensionPath)\n    $cgiIsapiExtensionFullPath = Resolve-Path -Path $cgiIsapiExtensionFullPath\n\n    $restrictionFound = $false\n    $cgiIsapiConfiguration | ForEach-Object {\n        $itemFullPath = [System.Environment]::ExpandEnvironmentVariables($_.path)\n        $itemFullPath = Resolve-Path -Path $itemFullPath\n\n        if ($itemFullPath.Path -eq $cgiIsapiExtensionFullPath.Path)\n        {\n           $restrictionFound = $true\n        }\n    }\n\n    if ($restrictionFound -eq $false)\n    {\n        Add-WebConfiguration -PSPath 'MACHINE/WEBROOT/APPHOST' -Filter \"system.webServer/security/isapiCgiRestriction\" -value @{description=\"$description\";path=\"$cgiIsapiExtensionPath\";allowed='True'}\n    }\n    else\n    {\n        Write-Host \"Allowed CGI/ISAPI Restriction for '$cgiIsapiExtensionPath' already exists.\"\n    }\n} `\n(Get-Param 'cgiIsapiExtensionPath' -Required) `\n(Get-Param 'description')",
    "Octopus.Action.Script.Syntax": "PowerShell"
  },
  "Category": "IIS",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/iis-add-isapicgirestrictionexception.json",
  "Website": "/step-templates/47e1a39c-65f3-43aa-ad5e-ea1946bbf368",
  "Logo": "https://i.octopus.com/library/step-templates/iis.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/iis-add-isapicgirestrictionexception.json)

</div>
