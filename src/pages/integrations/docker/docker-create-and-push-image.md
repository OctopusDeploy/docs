---
# This file is auto-generated by docs/tools/MarkdownGenerator (detail.js)
layout: src/layouts/Default.astro
pubDate: 2017-02-03
title: 'Docker - Create and Push Image'
description: 'Creates and pushes an Docker Image.

- Requires the Docker infrastructure.'
navMenu: false
# Set to true when launched
navSitemap: false
navSearch: false
---

Octopus.Script exported 2017-02-03 by joaoasrosa belongs to 'Docker' category.

## Parameters

When steps based on the template are included in a project's deployment process, the parameters below can be set.


<div class="param">

### Docker Username

`DockerUsername`

The username used to login to DockerHub

</div>
        
<div class="param">

### Docker Password

`DockerPassword`

The password used to login to DockerHub

</div>
        
<div class="param">

### Application Location

`ApplicationLocation`

The application location, used to build the Docker image

</div>
        
<div class="param">

### Dockerfile

`DockerFile`

The Dockerfile definition. If the Dockerfile is part of the package leave it blank

</div>
        
<div class="param">

### Image Name

`ImageName`

The image name in DockerHub

</div>
        
<div class="param">

### Image Tag

`ImageTag`

The image tag. Leave it blank for 'latest'

</div>
        

## Script body

Steps based on this template will execute the following *PowerShell* script.

```powershell
# Get the parameters.
$appLocation = $OctopusParameters['ApplicationLocation']
$dockerFile = $OctopusParameters['DockerFile']
$imageName = $OctopusParameters['ImageName']
$tag = $OctopusParameters['ImageTag']
$dockerUsername = $OctopusParameters['DockerUsername']
$dockerPassword = $OctopusParameters['DockerPassword']

# Check the parameters.
if (-NOT $dockerUsername) { throw "You must enter a value for 'Username'." }
if (-NOT $dockerPassword) { throw "You must enter a value for 'Password'." }
if (-NOT $imageName) { throw "You must enter a value for 'Image Name'." }
if (-NOT $appLocation) { throw "You must enter a value for 'Application Location'." }

# If the Dockerfile parameter is not empty, save it to the file.
if ($dockerFile) 
{
    Write-Output 'Saving the Dockerfile'
    $path = Join-Path $appLocation 'Dockerfile'
    Set-Content -Path $path -Value $dockerFile -Force
}

# If the tag parameter is empty, set it as latest.
if (-NOT $tag) 
{
    $tag = 'latest'
}

# Prepare the final image name with the tag.
$imageName += ':' + $tag

# Create the docker image
Write-Output 'Building the Docker Image'
docker build -t $imageName $appLocation

# Upload to DockerHub
Write-Output 'Pushing the Docker Image to DockerHub'
docker login -u $dockerUsername -p $dockerPassword
docker push $imageName
```

Provided under the [Apache License version 2.0](https://github.com/OctopusDeploy/Library/blob/master/LICENSE.txt).

[Report an issue](https://github.com/OctopusDeploy/Library/issues/new?assignees=&labels=&projects=&template=bug-report.yml&title=Issue%20with%20Docker%20-%20Create%20and%20Push%20Image&step-template=Docker%20-%20Create%20and%20Push%20Image)

<div class="get-json">

To use this template in Octopus Deploy, copy the JSON below and paste it into the **Library → Step templates → Import** dialog.

```json
{
  "Id": "3ff1e0ae-0336-41e3-905a-a1f10f4bb1cf",
  "Name": "Docker - Create and Push Image",
  "Description": "Creates and pushes an Docker Image.\n\n- Requires the Docker infrastructure.",
  "Version": 1,
  "ExportedAt": "2017-02-03T10:49:13.997Z",
  "ActionType": "Octopus.Script",
  "Author": "joaoasrosa",
  "Parameters": [
    {
      "Name": "DockerUsername",
      "Label": "Docker Username",
      "HelpText": "The username used to login to DockerHub",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "DockerPassword",
      "Label": "Docker Password",
      "HelpText": "The password used to login to DockerHub",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "Sensitive"
      }
    },
    {
      "Name": "ApplicationLocation",
      "Label": "Application Location",
      "HelpText": "The application location, used to build the Docker image",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "DockerFile",
      "Label": "Dockerfile",
      "HelpText": "The Dockerfile definition. If the Dockerfile is part of the package leave it blank",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "MultiLineText"
      }
    },
    {
      "Name": "ImageName",
      "Label": "Image Name",
      "HelpText": "The image name in DockerHub",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Name": "ImageTag",
      "Label": "Image Tag",
      "HelpText": "The image tag. Leave it blank for 'latest'",
      "DefaultValue": null,
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "Properties": {
    "Octopus.Action.Script.ScriptBody": "# Get the parameters.\n$appLocation = $OctopusParameters['ApplicationLocation']\n$dockerFile = $OctopusParameters['DockerFile']\n$imageName = $OctopusParameters['ImageName']\n$tag = $OctopusParameters['ImageTag']\n$dockerUsername = $OctopusParameters['DockerUsername']\n$dockerPassword = $OctopusParameters['DockerPassword']\n\n# Check the parameters.\nif (-NOT $dockerUsername) { throw \"You must enter a value for 'Username'.\" }\nif (-NOT $dockerPassword) { throw \"You must enter a value for 'Password'.\" }\nif (-NOT $imageName) { throw \"You must enter a value for 'Image Name'.\" }\nif (-NOT $appLocation) { throw \"You must enter a value for 'Application Location'.\" }\n\n# If the Dockerfile parameter is not empty, save it to the file.\nif ($dockerFile) \n{\n    Write-Output 'Saving the Dockerfile'\n    $path = Join-Path $appLocation 'Dockerfile'\n    Set-Content -Path $path -Value $dockerFile -Force\n}\n\n# If the tag parameter is empty, set it as latest.\nif (-NOT $tag) \n{\n    $tag = 'latest'\n}\n\n# Prepare the final image name with the tag.\n$imageName += ':' + $tag\n\n# Create the docker image\nWrite-Output 'Building the Docker Image'\ndocker build -t $imageName $appLocation\n\n# Upload to DockerHub\nWrite-Output 'Pushing the Docker Image to DockerHub'\ndocker login -u $dockerUsername -p $dockerPassword\ndocker push $imageName",
    "Octopus.Action.Script.Syntax": "PowerShell"
  },
  "Category": "Docker",
  "HistoryUrl": "https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/docker-create-and-push-image.json",
  "Website": "/step-templates/3ff1e0ae-0336-41e3-905a-a1f10f4bb1cf",
  "Logo": "https://i.octopus.com/library/step-templates/docker.png",
  "$Meta": {
    "Type": "ActionTemplate"
  }
}
```

[History](https://github.com/OctopusDeploy/Library/commits/master/step-templates/https://github.com/OctopusDeploy/Library/commits/master/step-templates//opt/buildagent/work/75443764cd38076d/step-templates/docker-create-and-push-image.json)

</div>
